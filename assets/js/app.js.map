{"version":3,"sources":["general/general.js","attachment/attachment.bootstrap.js","attachment/attachment.js","admin/admin.js","async/async.js","blog/blog.bootstrap.js","blog/blog.js","browser/browser.js","content/content.bootstrap.js","content/content.js","content/content.medium.js","config/config.js","crossbrowser/crossbrowser.js","download/download.js","fallback/fallback.js","event/event.js","gallery/gallery.js","focus/focus.js","importexport/importexport.bootstrap.js","importexport/importexport.js","history/history.js","info/info.js","multisite/multisite.js","routes/routes.bootstrap.js","routes/routes.js","sails/sails.js","session/session.js","sortable/sortable.js","sidebar/sidebar.js","signin/signin.bootstrap.js","signin/signin.js","theme/theme.js","subnavigation/subnavigation.js","uploader/uploader.bootstrap.js","toolbar/toolbar.js","user/user.js","utilities/utilities.js","validation/validation.bootstrap.js","validation/validation.js","app.js","i18n.js","log.js","routes.js","translations.js","AppController.js","ContentController.js","ErrorController.js","FooterController.js","HomeController.js","LayoutController.js","RoutesController.js","StatusController.js","ThemesController.js","ToolbarController.js","UserController.js","UsersController.js"],"names":["angular","module","directive","$compile","$window","mediumOptions","AttachmentService","restrict","templateUrl","scope","attachment","attachmentIndex","parent","path","authenticated","destroy","centerImage","link","$scope","$element","$attrs","console","log","controller","open","service","moment","$sailsSocket","$async","$log","url","target","destroyLocally","blogPosts","postIndex","cb","attachments","length","splice","destroyExternally","put","blogPostID","id","attachmentUploadedAs","uploadedAs","success","data","status","headers","config","debug","error","post","indexOf","err","$state","upload","download","toogleHtml","refresh","save","add","addDropdown","addDropdownActions","adminSettingDropdown","allowActions","goToState","go","isUndefined","text","click","async","objectMap","obj","func","i","arr","keys","Object","wrapper","this","map","res","focus","BlogService","$modal","FileUploader","editModal","typeModal","page","openTypeChooserModal","blogPost","$promise","then","show","setModals","fileOptions","pageString","onFileCompleteCallback","isString","title","ok","accept","hide","abort","thumbnail","width","rescrop","cropwidth","cropheight","uploadOptions","removeAfterUpload","options","JSON","stringify","uploader","isFunction","onComplete","onCompleteItem","fileItem","response","isArray","files","push","onProgressItem","progress","chooseType","$on","modalEvent","validate","callback","getModals","getEditModal","getTypeModal","edit","createEdit","create","update","$filter","types","deleteAttachment","fix","type","removeFromClient","index","users","sort","reverse","transform","append","moreBlogPosts","apply","prepent","unshift","createdAt","content","author","object","name","toLowerCase","replace","fixEach","objects","saveOne","errors","isDefined","saveBlocks","blogPostsArray","find","limit","skip","resp","count","subscribe","msg","verb","$rootScope","pop","findEvent","blogPostBlock","resolve","remove","destroyAttachment","force","ImportExportBootstrapService","UtilityService","ContentService","SortableService","modals","host","setHost","newHost","setupImportModal","onImportFinsih","onCompleteFile","concat","setImports","identifierKey","descriptionKey","onImportStart","imports","next","item","importOptions","doImport","updateOrCreateByHostByTitleAndPage","results","onAbort","showImportModal","$download","JLSailsService","showHtml","getShowHtml","setEditModal","changeName","$watch","newValue","oldValue","generateName","event","validateContent","toogleShowHtml","contents","beautifyEach","beautify","html_beautify","getByName","findKeyValue","swap","index_1","index_2","moveForward","moveBackward","isNumber","position","warn","saveParallel","logger","parallel","applyResults","extend","findOne","query","Array","findAll","findByHost","method","resultIsArray","exportByHost","findAllWithImage","get","images","resolveOne","resolveAll","resolveAllWithImage","value","buttonLabels","toolbar","buttons","Imager","button","document","createElement","className","innerText","innerHTML","onclick","onClick","bind","prototype","classApplier","toggleSelection","getButton","checkState","node","tagName","classList","ContentMediumService","html","mediumBindOptions","extensions","image","SubnavigationService","HistoryService","navs","afterRefresh","afterSave","afterRemove","afterEdit","afterAdd","subnavigation","afterSaveNav","afterRemoveNav","afterEditNav","afterAddNav","goTo","goToHashPosition","current","result","toggleHtml","Date","now","getTime","vendors","window","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","nextTime","Math","max","setTimeout","clearTimeout","$location","protocol","charAt","info","eventBlockName","split","events","unknown","before","after","to","from","isAfter","invertOrder","merge","allEvents","minutes","person","place","eventBlocks","saveAllInBlock","eventBlocksArray","eventBlock","EventService","Fullscreen","uploadModal","fullscreenImage","dropdown","getDropdown","prepairUploadModal","imageBlocks","contentBlocks","selects","getSelects","selectedContentBlock","setUploadModal","onCompleteCallback","filters","fn","slice","lastIndexOf","forEach","file","selected","currentImages","last_position","original","getUploadModal","blockNames","blockName","array","label","contentname","saveAllBlocks","saveAll","filename","addBlock","aspect","height","scale","aspectRatio","win","paddingTopBottom","paddingLeftRight","isFullScreen","getWindowDimensions","padding-right","padding-left","padding-top","padding-bottom","factory","$timeout","element","getElementById","elem","attr","on","eventFocus","eventFocusId","off","jumplink","onCompleteItemCallback","alias","onCompleteAll","identifier","description","$anchorScroll","history","state","params","all","step","prev","previous","abs","back","hash","yOffset","autoScroll","run","toParams","fromParams","warns","infoUser","infoAdmin","restart","resolveNames","resolveHosts","RoutesService","updateOrCreateByHostByObjectNameAndNavbar","provider","jlRoutesProvider","$stateProvider","$urlRouterProvider","$locationProvider","html5Mode","otherwise","when","url1","url2","setLayouts","layouts","stateName","setRoutes","routes","routeOptions","main","customstate","eval","views","view","objectName","isObject","alternativeUrls","a","$get","jlRoutes","filter","active","match","fallback","route","updateOrCreate","updateOrCreateByHost","updateOrCreateEach","updateOrCreateEachByHost","generateObjectnameFromStatename","statename","objectname","k","capitalizeFirstLetter","lowercaseFirstLetter","generateObjectnameFromUrl","saveEachByHost","$q","deferred","defer","reject","promise","user","isAuthenticated","needToBeAuthenticated","bloggerOrBetter","developerOrBetter","siteadminOrBetter","superadmin","employee","employeeOrBetter","needToBeEmployeeOrBetter","needToBeSiteadminOrBetter","getAllPolicies","getUser","resetPosition","object_1","object_2","position_tmp","move","old_index","new_index","undefined","unique","uniqueKey","new_object","new_position","uniqueIndex","okay","moveObjectToAnotherArray","index_from","array_from","array_to","replaceData","errorParamsNotSet","index_to","dropMove","dropObjectIndex","dragObject","moveFunction","dragObjectIndex","dropObject","transclude","SigninService","siginWithModal","goBackAfterSignin","extendRoles","signinModal","aborted","email","password","signin","SessionService","isSubscribed","themes","resizeOnImagesLoaded","imagesLoaded","triggerHandler","Number","nav","removeByTarget","fixed","addNav","moveForwardNav","moveBackwardNav","editNavs","removeNav","onDragOnComplete","evt","onDragOnNavComplete","onDropOnComplete","dropnavindex","dragnav","onDropOnNavComplete","onDropOnAreaComplete","labelFiles","shorttitle","fluid","fullscreenIsSupported","isSupported","isFullscreen","isFullscreenEnabled","toggleFullscreen","isEnabled","cancel","role","key","getKeys","string","toUpperCase","jlValidationProvider","$validationProvider","setup","setErrorHTML","setSuccessHTML","validCallback","$","parents","removeClass","addClass","invalidCallback","getLocale","changeLocale","jlValidationBootstrap","defaultMsg","minlength","getDefaultMsg","maxlength","required","number","lang","setDefaultMsg","jlValidation","cms","amMoment","$logProvider","debugEnabled","abstract","sites","MultisiteService","hosts","layoutHome","template","layoutThemes","layoutRoutes","layoutContent","footer","layoutUsers","$stateParams","layoutStatus","CmsService","toState","fromState","toaster","body","timeout","bodyOutputType","clickHandler","generalSubscribes","adminSubscribes","subject","mainStyle","toasterPositionClass","$apply","loadclass","bodyclass","onresize","windowHeight","windowWidth","logout","ContentBootstrapService","showMaincontents","selectedHost","$index","site","isSuperadmin","selectedSite","RoutesBootstrapService","showMainRoutes","appendToStatename","toAppend","generateObjectnameAndStatename","addAlternativeUrl","removeAlternativeUrl","$interval","calcUptime","uptime","pm2","pm2_env","pm_uptime","fromNow","ThemeService","themeSettings","available","UserService"],"mappings":"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","file":"app.js","sourcesContent":["if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}","angular.module('jumplink.cms.bootstrap.attachment', [\n  'jumplink.cms.attachment',\n])\n.directive('jlAttachmentBootstrap', function ($compile, $window, mediumOptions, AttachmentService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/attachment.bootstrap.jade',\n    scope: {\n      attachment: \"=\",\n      attachmentIndex: \"=\",\n      parent: \"=\",\n      path: \"=\",\n      authenticated: \"=\",\n      destroy: \"=\",\n      centerImage: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      console.log(\"[jlAttachmentBootstrap.link]\", $scope);\n    },\n    controller: function ($scope, AttachmentService) {\n      $scope.open = AttachmentService.open;\n    }\n  };\n});","angular.module('jumplink.cms.attachment', [\n  'sails.io',\n])\n\n.service('AttachmentService', function (moment, $sailsSocket, $async, $log, $window) {\n\n  var open = function (url, target) {\n    $window.open(url, target);\n  };\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var destroyLocally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    if(blogPosts[postIndex].attachments.length > 0) {\n      blogPosts[postIndex].attachments.splice(attachmentIndex, 1);\n    }\n    return cb(null, blogPosts, postIndex, attachmentIndex);\n  };\n\n  /**\n   * delete attachment extern / server\n   */\n  var destroyExternally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    $sailsSocket.put('/blog/destroyAttachment', {blogPostID: blogPosts[postIndex].id, attachmentUploadedAs: blogPosts[postIndex].attachments[attachmentIndex].uploadedAs})\n    .success(function (data, status, headers, config) {\n      $log.debug(null, data, status, headers, config);\n      cb();\n    })\n    .error(function (data, status, headers, config) {\n      $log.error(data, status, headers, config);\n      cb(\"error\", data, status, headers, config);\n    });\n  };\n\n  var destroy = function (blogPosts, post, attachmentIndex, cb) {\n    var postIndex = blogPosts.indexOf(post);\n    $log.debug(\"[BlogService.destroy]\", blogPosts[postIndex], attachmentIndex);\n    return destroyExternally(blogPosts, postIndex, attachmentIndex, function (err, data, status, headers, config) {\n      if(err) {\n        return cb(err, data, status, headers, config);\n      }\n      return destroyLocally(blogPosts, postIndex, attachmentIndex, cb);\n    });\n  };\n\n  return {\n    open: open,\n    destroyLocally: destroyLocally,\n    destroyExternally: destroyExternally,\n    destroy: destroy,\n  };\n});","angular.module('jumplink.cms.admin', [\n    'sails.io',\n  ])\n\n  .directive('adminbar', function ($compile, $window, $sailsSocket, $state) {\n\n    return {\n      restrict: 'E',\n      templateUrl: '/views/modern/adminbar.jade',\n      scope: {\n        upload : \"=?\",\n        download : \"=?\",\n        toogleHtml: \"=?\",\n        refresh: \"=?\",\n        save: \"=?\",\n        add: \"=?\",\n        addDropdown: \"=?\",\n        addDropdownActions: \"=?\",\n        adminSettingDropdown: \"=?\",\n        authenticated: \"=?\",\n        allowActions: \"=?\",\n      },\n      link: function ($scope, $element, $attrs) {\n\n        $scope.goToState = $state.go;\n\n        if(angular.isUndefined($scope.adminSettingDropdown)) {\n          $scope.adminSettingDropdown = [\n            {\n              \"text\": \"<i class=\\\"fa fa-list\\\"></i>&nbsp;Übersicht\",\n              \"click\": \"goToState('layout.administration')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-users\\\"></i>&nbsp;Benutzer\",\n              \"click\": \"goToState('layout.users')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-sign-out\\\"></i>&nbsp;Abmelden\",\n              \"click\": \"$root.logout()\"\n            }\n          ];\n        }\n      }\n    };\n  })\n\n;","angular.module('ngAsync', [])\n.service('$async', function () {\n  // https://github.com/caolan/async/issues/374#issuecomment-27498818\n  async.objectMap = function ( obj, func, cb ) {\n    var i, arr = [], keys = Object.keys( obj );\n    for ( i = 0; i < keys.length; i += 1 ) {\n      var wrapper = {};\n      wrapper[keys[i]] = obj[keys[i]];\n      arr[i] = wrapper;\n    }\n    this.map( arr, func, function( err, data ) {\n      if ( err ) { return cb( err ); }\n      var res = {};\n      for ( i = 0; i < data.length; i += 1 ) {\n          res[keys[i]] = data[i];\n      }\n      return cb( err, res );\n    });\n  };\n  return async;\n});","angular.module('jumplink.cms.bootstrap.blog', [\n  'jumplink.cms.blog',\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'ngFocus',\n])\n\n.service('BlogBootstrapService', function ($log, focus, BlogService, $modal, FileUploader) {\n\n  var editModal = null;\n  var typeModal = null;\n  var page = null;\n\n  var openTypeChooserModal = function(blogPost) {\n    typeModal.$scope.blogPost = blogPost;\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString, onFileCompleteCallback) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n\n    editModal = $modal({title: 'Blogpost bearbeiten', templateUrl: '/views/modern/blog/editmodal.bootstrap.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {\n        path: 'assets/files/blog', // TODO get path from config\n        thumbnail: {\n          width: 300,\n          path: 'assets/files/blog' // TODO get path from config\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'blog/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    if(angular.isFunction(onFileCompleteCallback)) {\n      $scope.uploader.onComplete = onFileCompleteCallback;\n    }\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      $log.debug(\"[BlogBootstrapService.onCompleteItem] fileItem\", fileItem, \"response\", response);\n      if(!angular.isArray(fileItem.blogPost.attachments)) {\n        fileItem.blogPost.attachments = [];\n      }\n      for (var i = 0; i < response.files.length; i++) {\n        fileItem.blogPost.attachments.push(response.files[i]);\n      }\n    };\n\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      $log.debug('[BlogBootstrapService.onProgressItem]', fileItem, progress);\n    };\n\n    editModal.$scope.upload = function(fileItem, blogPost) {\n      fileItem.blogPost = blogPost;\n      fileItem.upload();\n    };\n\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/blog/typechoosermodal.bootstrap.jade', show: false});\n    typeModal.$scope.chooseType = BlogService.chooseType;\n\n    editModal.$scope.$on('modal.hide.before',function(modalEvent, editModal) {\n      $log.debug(\"edit closed\", editModal.$scope.blogPost, editModal);\n      if(editModal.$scope.ok) {\n        // BlogService.saveOne(null, editModal.$scope.blogPost, null, page, function (err, result) {\n        //   editModal.$scope.blogPost = result\n        //   return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n        // });\n        return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n      } else {\n        if(editModal.$scope.callback) {\n          editModal.$scope.callback(\"discarded\", editModal.$scope.blogPost);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getEditModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(blogPost, cb) {\n    $log.debug(\"[BlogService.edit]\", blogPost);\n    editModal.$scope.blogPost = blogPost;\n    editModal.$scope.callback = cb;\n    editModal.$scope.ok = false;\n\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var createEdit = function(blogPosts, blogPost, cb) {\n    blogPost = BlogService.create(blogPost); \n    edit(blogPost, cb);\n  };\n\n  return {\n    edit: edit,\n    update: edit, // alias\n    createEdit: createEdit,\n    setModals: setModals,\n    openTypeChooserModal: openTypeChooserModal,\n  };\n});","angular.module('jumplink.cms.blog', [\n  'jumplink.cms.attachment',\n  'angularMoment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('BlogService', function (moment, $sailsSocket, $async, $log, $filter, AttachmentService) {\n\n  var types = ['news', 'other'];\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var deleteAttachmentLocally = AttachmentService.destroyLocally;\n\n  /**\n   * delete attachment extern / server\n   */\n  var deleteAttachmentExternally = AttachmentService.destroyExternally;\n\n  var deleteAttachment = AttachmentService.destroy;\n\n  var validate = function (blogPost, page, callback) {\n    if(blogPost.title) {\n      return fix(blogPost, page, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", blogPost);\n    }\n    return null;\n  };\n\n  var chooseType = function(blogPost, type) {\n    blogPost.type = type;\n  };\n\n  var removeFromClient = function (blogPosts, blogPost, callback) {\n    // $log.debug(\"removeFromClient\", blogPost);\n    var index = blogPosts.indexOf(blogPost);\n    if (index > -1) {\n      blogPosts.splice(index, 1);\n      if(angular.isFunction(callback)) {\n        callback(null, blogPosts);\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(\"no blogPost on client site found to remove\", blogPosts);\n      }\n    }\n  };\n\n  var destroy = function(blogPosts, blogPost, callback) {\n    // $log.debug(\"remove blogPost\", blogPost);\n    if(blogPost.id) {\n      $log.debug(\"[jumplink.cms.blog.BlogService.destroy]\", blogPost);\n      $sailsSocket.delete('/blog/'+blogPost.id).success(function(users, status, headers, config) {\n        removeFromClient(blogPosts, blogPost, callback);\n      });\n    } else {\n      removeFromClient(blogPosts, blogPost, callback);\n    }\n  };\n\n  var sort = function(blogPosts) {\n    var reverse = true;\n    return $filter('orderBy')(blogPosts, 'createdAt', reverse);\n  };\n\n  var transform = function(blogPosts) {\n    blogPosts = sort(blogPosts);\n    return blogPosts;\n  };\n\n  var append = function(blogPosts, moreBlogPosts, callback) {\n    blogPosts.push.apply(blogPosts, moreBlogPosts);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var prepent = function(blogPosts, blogPost, callback) {\n    blogPosts.unshift(blogPost);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var create = function(data) {\n    if(!data || !data.createdAt) {\n      data.createdAt = moment();\n    }\n    // if(!data || !data.updatedAt) data.createdAt = moment();\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.author) {\n      data.author = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    if(!data || !data.type) {\n      data.type = types[0]; // news\n    }\n    $log.debug(\"[BlogService,create]\", data);\n    return data;\n  };\n\n  var createEdit = function(blogPosts, blogPost, callback) {\n    blogPost = create(blogPost); \n    edit(blogPost, callback);\n  };\n\n  var fix = function(object, page, callback) {\n    if(angular.isUndefined(object.page) && page !== null) {\n      object.page = page;\n    }\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, page, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i], page);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(blogPosts, callback) {\n    $log.debug(\"[jumplink.cms.blog.BlogService.refresh]\");\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var saveOne = function (blogPosts, blogPost, index, page, callback) {\n    var errors = [\n      \"BlogService: Can't save blogPost.\",\n      \"BlogService: Can't save blogPost, blogPost to update not found.\",\n      \"BlogService: Can't save blogPost, parameters undefind.\",\n    ];\n    $log.debug(\"[BlogService.saveOne]\", blogPost);\n    if(angular.isDefined(blogPost) && angular.isDefined(callback)) {\n      blogPost = fix(blogPost, page);\n      if(angular.isUndefined(blogPost.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/blog', blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          callback(null, data);\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/blog/'+blogPost.id, blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          return callback(null, data);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      }\n    } else {\n      return callback(errors[2]);\n    }\n  };\n\n  var saveBlocks = function(blogPosts, page, callback) {\n    var errors = [\n      \"[BlogService.saveBlocks] Can't save blogPosts, parameters undefind.\"\n    ];\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPosts) && angular.isDefined(callback)) {\n      $async.map(blogPosts, function (blogPost, callback) {\n        saveOne(blogPosts, blogPost, null, page, callback);\n      }, function(err, blogPostsArray) {\n        if(err) {\n          return callback(err);\n        }\n        blogPosts = transform(blogPosts);\n        return callback(null, blogPosts);\n      });\n    } else {\n      $log.error(errors[0]);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0]);\n      }\n    }\n  };\n\n  var save = function(blogPosts, blogPost, index, page, callback) {\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPost)) {\n      saveOne(blogPosts, blogPost, index, page, callback);\n    } else { // save all blogPostBlocks\n      saveBlocks(blogPosts, page, callback);\n    }\n  };\n\n  var find = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/find', {page:page, limit:limit, skip:skip}).then (function (data) {\n      data.data = transform(data.data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on find \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var count = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/count', {page:page}).then (function (data) {\n      // $log.debug(data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data.count);\n      }\n      return data.data.count;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('blog', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              blogPost = msg.data;\n            }\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde erstellt', msg.data.title);\n          }\n          $scope.blogPosts.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    validate: validate,\n    subscribe: subscribe,\n    append: append,\n    prepent: prepent,\n    sort: sort,\n    transform: transform,\n    saveOne: saveOne,\n    saveBlocks: saveBlocks,\n    save: save,\n    fixEach: fixEach,\n    find: find,\n    resolve: find, // alias\n    count: count,\n    refresh: refresh,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: destroy, // alias\n    destroy: destroy,\n    deleteAttachment: deleteAttachment,\n    destroyAttachment: deleteAttachment, // alias\n    create: create\n  };\n});","angular.module('jumplink.cms.browser', [])\n.directive('jlBrowser', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/browser.bootstrap.jade',\n    scope: {\n      force: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      \n    }\n  };\n});","angular.module('jumplink.cms.bootstrap.content', [\n  'jumplink.cms.content',\n])\n/**\n * TODO move other bootstrap stuff from  ContentService to this ContentBootstrapService\n */\n.service('ContentBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, ContentService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[ContentBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'name', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          ContentService.updateOrCreateByHostByTitleAndPage(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[ContentBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n});","angular.module('jumplink.cms.content', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'ui.ace',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities',\n])\n.service('ContentService', function ($rootScope, $log, $sailsSocket, $filter, $modal, $download, JLSailsService, SortableService, UtilityService, focus, $async) {\n\n  var showHtml = false;\n  var editModal = null;\n\n  var getShowHtml = function() {\n    return showHtml;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({title: 'Inhaltsblock bearbeiten', templateUrl: '/views/modern/contentmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n    editModal.$scope.changeName = false;\n\n    editModal.$scope.$watch('content.title', function(newValue, oldValue) {\n      // $log.debug(\"Content in Content Modal changed!\", \"new\", newValue, \"old\", oldValue);\n      if(editModal.$scope.changeName && angular.isDefined(editModal.$scope.content)) {\n        editModal.$scope.content.name = generateName(newValue);\n      }\n    });\n\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      // $log.debug(\"edit closed\", event, editModal);\n      editModal.$scope.changeName = false;\n      if(editModal.$scope.ok) {\n        return validateContent(editModal.$scope.content, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.content);\n      }\n    });\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('content', function(msg){\n      $log.debug(\"Content event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Seite wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  var toogleShowHtml = function(contents, callback) {\n    showHtml = !showHtml;\n    if(showHtml && contents) {\n      contents = beautifyEach(contents);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, showHtml);\n    }\n    return showHtml;\n  };\n\n  var beautify = function(content, callback) {\n    content.content = html_beautify(content.content);\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  var beautifyEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i].content = beautify(contents[i].content);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var getByName = function (contents, name) {\n    var index = UtilityService.findKeyValue(contents, 'name', name);\n    if(index > -1) {\n      return contents[index];\n    }\n    return null;\n  };\n\n  var create = function(data) {\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.type) {\n      data.type = \"dynamic\";\n    }\n    if(!data || !data.page) {\n      $log.error(\"[ContentService] Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(contents, content, callback) {\n    SortableService.append(contents, content, callback, true, 'name');\n  };\n\n  var createEdit = function(contents, page, callback) {\n    var data = create({page:page});\n    edit(data, callback, true);\n  };\n\n  var swap = function(contents, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, contents, callback) {\n    return SortableService.moveForward(index, contents, callback);\n  };\n\n  var moveBackward = function(index, contents, callback) {\n    return SortableService.moveBackward(index, contents, callback);\n  };\n\n  var validateContent = function (content, callback) {\n    if(content.title) {\n      return fix(content, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", content);\n    }\n    return null;\n  };\n\n  var edit = function(content, callback, changeName) {\n    $log.debug(\"edit\", content);\n    editModal.$scope.content = content;\n    editModal.$scope.callback = callback;\n    if(changeName) {\n      editModal.$scope.changeName = changeName;\n    }\n    else {\n      editModal.$scope.changeName = false;\n    }\n    focus('contentedittitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var removeFromClient = function (contents, index, content, callback) {\n    return SortableService.remove(index, contents, callback);\n  };\n\n  var remove = function(contents, index, content, page, callback) {\n    var errors = [\n      'Content konnte nicht gelöscht werden.'\n    ];\n    if(typeof(index) === 'undefined' || index === null) {\n      index = contents.indexOf(content);\n    }\n    // remove from client\n    contents = SortableService.remove(contents, index, content);\n    // if content has an id it is saved on database, if not, not\n    if(content.id) {\n      $log.debug(\"remove from server, too\" ,content);\n      $sailsSocket.delete('/content/'+content.id+\"?page=\"+page, {id:content.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    }\n  };\n\n  var refresh = function(contents, callback) {\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        $log.error(err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      beautifyEach(contents, function(err, contents) {\n        if(err) {\n          $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      });\n    });\n  };\n\n  var generateName = function (title) {\n    var name = \"\";\n    if(title && title !== \"\") {\n      // Set content.name to content.title but only the letters in lower case\n      name = title.toLowerCase().replace(/[^a-z1-9]+/g, '');\n      $log.debug(\"set content.name to\", name);\n    }\n    return name;\n  };\n\n  /*\n   * Validate and fix content to make it saveable\n   */\n  var fix = function(content, callback) {\n\n    if(angular.isDefined(content)) {\n      if(angular.isUndefined(content.name) || content.name === '' || content.name === null) {\n        content.name = generateName(content.title);\n      }\n\n      if(!angular.isNumber(content.position)) {\n        content.position = 0;\n      }\n\n      if(!content.type || content.type === \"\") {\n        $log.warn(\"Fix content type not set, set it to dynamic\");\n        content.type = 'fix';\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(\"content not set\");\n      }\n      return null;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  /*\n   * Validate and fix all contents to make them saveable\n   */\n  var fixEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i] = fix(contents[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var saveOne = function(content, page, callback) {\n    var errors = [\n      'Inhalt konnte nicht gespeichert werden'\n    ];\n    content.page = page;\n    fix(content, function(err, content) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      $sailsSocket.put('/content/replace', content).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          content = data;\n          // $log.debug (content);\n          if(angular.isFunction(callback)) {\n            return callback(null, content);\n          }\n          return content;\n        } else {\n          $log.error(errors[0]);\n          if(angular.isFunction(callback)) {\n            return callback(errors[0]);\n          }\n          return errors[0];\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    });\n  };\n\n  var save = function(contents, page, callback) {\n    var errors = [\n      'Seite konnte nicht gespeichert werden'\n    ];\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      return $sailsSocket.put('/content/replaceall', {contents: contents, page: page}).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          contents = $filter('orderBy')(data, 'position');\n          // $log.debug (data);\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        }\n        $log.error(errors[0]);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0]);\n        }\n        return errors[0];\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    });\n  };\n  \n  var saveParallel = function(page, logger, options, obj, callback) {\n    $async.parallel(obj, function(err, results) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        logger('error', 'Seiteninhalt konnte nichtgespeichert werden', err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      if(options.applyResults) {\n        options.scope = angular.extend(options.scope, results);\n      }\n      logger('success', 'Seiteninhalt wurde gespeichert', \"\");\n      if(angular.isFunction(callback)) {\n        return callback(null, results);\n      }\n      return results;\n    });\n  };\n\n  var findOne = function(page, name, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find one with page: \"+page+\", name: \"+name,\n      \"request has more than one results\"\n    ];\n    var query = {\n      page: page,\n      name: name\n    };\n    var url = '/content/find';\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        return null;\n      }\n      if(data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.error(errors[1]);\n      }\n      // data.data.content = html_beautify(data.data.content);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  var findAll = function(page, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {};\n    var url = '/content/findall';\n    if(angular.isDefined(page) && page !== null) {\n      query.page = page;\n    }\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data = $filter('orderBy')(data.data, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n\n      if(angular.isFunction(callback)) {\n        callback(null, data.data);\n      } else {\n        return data.data;\n      }\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Content/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[ContentService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Content/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[ContentService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"content.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create content for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save content for\n   */\n  var updateOrCreateByHostByTitleAndPage = function(host, content, callback) {\n    $log.debug(\"[contentsService.updateOrCreateByHostByTitleAndPage]\", host, content);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Content/updateOrCreateByHostByTitleAndPage', {host: host, content: content}, options, callback);\n  };\n  /*\n   * get all contents for page including images for each content.name \n   */\n  var findAllWithImage = function(page, type, callback, next) {\n    // $log.debug(\"findAllWithImage\");\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {\n      page: page\n    };\n    var url = '/content/findAllWithImage?page='+page;\n    if(type) {\n      query.type = type;\n      url = url+'&type='+type;\n    }\n    return $sailsSocket.get(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data.contents = $filter('orderBy')(data.data.contents, 'position');\n      data.data.images = $filter('orderBy')(data.data.images, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   *\n   */\n  var find = function(page, name, type, callback, next) {\n    //- get soecial content (one)\n    if(angular.isDefined(name)) {\n      return findOne(page, name, type, next);\n    // get all for page\n    } else {\n      return findAll(page, type, callback, next);\n    }\n  };\n\n  return {\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getShowHtml: getShowHtml,\n    toogleShowHtml: toogleShowHtml,\n    beautify: beautify,\n    beautifyEach: beautifyEach,\n    create: create,\n    createEdit: createEdit,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    refresh: refresh,\n    fix: fix,\n    fixEach: fixEach,\n    save: save,\n    saveOne: saveOne,\n    saveParallel: saveParallel,\n    find: find,\n    resolve: find, // alias\n    findOne: findOne,\n    resolveOne: findOne, // alias\n    findAll: findAll, \n    resolveAll: findAll, //alias\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreateByHostByTitleAndPage: updateOrCreateByHostByTitleAndPage,\n    findAllWithImage: findAllWithImage,\n    resolveAllWithImage: findAllWithImage,  //alias\n    getByName: getByName\n  };\n});","angular.module('jumplink.cms.content.medium', [\n  'jumplink.cms.content',\n  'angular-medium-editor',\n])\n.value('mediumOptions', {\n  buttonLabels: \"fontawesome\",\n  toolbar: {\n    buttons: [\"bold\", \"italic\", \"underline\", \"anchor\", \"h2\", \"h3\", \"h4\", \"quote\", \"orderedlist\", \"unorderedlist\"]\n  }\n})\n.service('ContentMediumService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n  // TODO\n  var Imager = function () {\n    this.button = document.createElement('button');\n    this.button.className = 'medium-editor-action';\n    this.button.innerText = 'Image';\n    this.button.innerHTML = '<i class=\"fa fa-picture-o\"></i>';\n    this.button.onclick = this.onClick.bind(this);\n    // this.classApplier = rangy.createCssClassApplier('highlight', {\n    //   elementTagName: 'mark',\n    //   normalize: true\n    // });\n  };\n  Imager.prototype.onClick = function() {\n    this.classApplier.toggleSelection();\n  };\n  Imager.prototype.getButton = function() {\n    return this.button;\n  };\n  Imager.prototype.checkState = function(node) {\n    if (node.tagName === 'MARK') {\n      this.button.classList.add('medium-editor-button-active');\n    }\n  };\n\n  return {\n    Imager: Imager\n  };\n})\n.directive('jlContent', function ($compile, $window, mediumOptions, ContentMediumService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/content.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      content: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n      if(angular.isUndefined($scope.mediumOptions)) {\n        $scope.mediumOptions = mediumOptions;\n      }\n      if(angular.isUndefined($scope.mediumBindOptions)) {\n        $scope.mediumBindOptions = {\n          extensions: {\n            'image': new ContentMediumService.Imager()\n          }\n        };\n      }\n    }\n  };\n})\n.directive('jlContentBlocks', function ($compile, $window, mediumOptions, ContentMediumService, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/contentBlocks.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      contents: \"=\",\n      navs: \"=?\",\n      afterRefresh: \"=?\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      subnavigation: \"=?\",\n      afterSaveNav: \"=?\",\n      afterRemoveNav: \"=?\",\n      afterEditNav: \"=?\",\n      afterAddNav: \"=?\",\n      logger: \"=\",\n      page: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      ContentService.setEditModal($scope);\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      ContentService.subscribe();\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.subnavigation)) {\n        $scope.subnavigation = false;\n      }\n\n      if(angular.isUndefined($scope.afterRefresh)) {\n        $scope.afterRefresh = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht erneuert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock erneuert!\", \"\");\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock hinzugefügt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSaveNav)) {\n        $scope.afterSaveNav = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n\n      $scope.add = function() {\n        var errors = [\n          \"Error: Konnte Inhaltsblock nicht erzeugen\",\n          \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n        ];\n\n        var successes = [\n          \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n          \"Neue Subnavigation erfolgreich hinzugefügt\",\n          \"Neuen Block erfolgreich hinzugefügt\",\n        ];\n\n        if(!$scope.authenticated) {\n          return false;\n        }\n        // generates new content and opens the modal\n        ContentService.createEdit($scope.contents, $scope.page, function(err, content) {\n          if(err) {\n            return $scope.afterAdd(err);\n          }\n          ContentService.append($scope.contents, content, $scope.afterAdd);  \n        });\n      };\n\n      $scope.moveForward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }       \n        SortableService.moveForward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content forward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.moveBackward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.edit = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.edit(content, $scope.afterEdit);\n      };\n\n      $scope.remove = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.remove($scope.contents, index, content, $scope.page, $scope.afterRemove);\n      };\n\n      $scope.refresh = function() {\n        ContentService.refresh($scope.contents, $scope.afterRefresh);\n      };\n\n      $scope.toggleHtml = function(index, content) {\n        content.html = content.html !== true;\n      };\n\n      $scope.save = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.save($scope.contents, $scope.page, $scope.afterSave);\n        if($scope.subnavigation) {\n          SubnavigationService.save($scope.navs, $scope.page, $scope.afterSaveNav);\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.config', [\n  'sails.io',\n])\n.service('ConfigService', function ($sailsSocket, $filter, $log) {\n  var resolve = function(page) {\n    return $sailsSocket.get('/config/find').then (function (data) {\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n  return {\n    resolve: resolve\n  };\n});","// window.saveAs\n// Shims the saveAs method, using saveBlob in IE10. \n// And for when Chrome and FireFox get round to implementing saveAs we have their vendor prefixes ready. \n// But otherwise this creates a object URL resource and opens it on an anchor tag which contains the \"download\" attribute (Chrome)\n// ... or opens it in a new tab (FireFox)\n// @author Andrew Dodson\n// @copyright MIT, BSD. Free to clone, modify and distribute for commercial and personal use.\n// window.saveAs || ( window.saveAs = (window.navigator.msSaveBlob ? function(b,n){ return window.navigator.msSaveBlob(b,n); } : false) || window.webkitSaveAs || window.mozSaveAs || window.msSaveAs || (function(){\n//   // URL's\n//   window.URL || (window.URL = window.webkitURL);\n//   if(!window.URL){\n//     return false;\n//   }\n//   return function(blob,name){\n//     var url = URL.createObjectURL(blob);\n//     // Test for download link support\n//     if( \"download\" in document.createElement(\"a\") ){\n//       var a = document.createElement(\"a\");\n//       a.setAttribute(\"href\", url);\n//       a.setAttribute(\"download\", name);\n//       // Create Click event\n//       var clickEvent = document.createEvent (\"MouseEvent\");\n//       clickEvent.initMouseEvent (\"click\", true, true, window, 0, \n//         clickEvent.screenX, clickEvent.screenY, clickEvent.clientX, clickEvent.clientY, \n//         clickEvent.ctrlKey, clickEvent.altKey, clickEvent.shiftKey, clickEvent.metaKey, \n//         0, null);\n//       // dispatch click event to simulate download\n//       a.dispatchEvent (clickEvent);\n//     }\n//     else{\n//       // fallover, open resource in new tab.\n//       window.open(url, \"_blank\", \"\");\n//     }\n//   };\n// })() );\n\n// Source: https://github.com/darius/requestAnimationFrame\n// Adapted from https://gist.github.com/paulirish/1579671 which derived from\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller.\n// Fixes from Paul Irish, Tino Zijdel, Andrew Mao, Klemen Slavič, Darius Bacon\n\n// MIT license\n\nif (!Date.now) {\n  Date.now = function() { return new Date().getTime(); };\n}\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n          var now = Date.now();\n          var nextTime = Math.max(lastTime + 16, now);\n          return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());","// https://github.com/rndme/download\nangular.module('ngDownload', [])\n.service('$download', function ($log) { \n  if(angular.isDefined(download)) {\n    return download;\n  } else {\n    $log.error(\"[ngDownload] download is not defined, please install it from https://github.com/rndme/download\");\n    return null;\n  }\n  \n});","angular.module('jumplink.cms.fallback', [\n])\n.service('FallbackService', function ($window, $location, $log) {\n\n  var go = function(path) {\n    var protocol = $location.protocol();\n    var host = $location.host();\n    if(!angular.isString(path)) {\n      path = \"/fallback\";\n    } else {\n      if(path.charAt(0) !== '/') {\n        path = '/'+path;\n      }\n    }\n    var url = protocol+\"://\"+host+path+\"?force=fallback\";\n    $log.debug(\"Go to fallback url: \"+url);\n    // $window.location.href = url;\n  };\n\n  return {\n    go: go\n  };\n});","angular.module('jumplink.cms.event', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'angularMoment',\n  'ngFocus',\n  'ngAsync',\n  'sails.io',\n  'jumplink.cms.utilities',\n])\n.service('EventService', function (moment, UtilityService, $sailsSocket, $async, $log, focus, $modal, FileUploader) {\n  var editModal = null;\n  var typeModal = null;\n  var types = ['lecture', 'panel discussion', 'travel', 'info', 'food', 'other'];\n  var page = null;\n\n  var validate = function (event, callback) {\n    if(event.title) {\n      return fix(event, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", event);\n    }\n    return null;\n  };\n\n  var chooseType = function(event, type, hide) {\n    event.type = type;\n    hide();\n  };\n\n  var openTypeChooserModal = function(event) {\n    typeModal.$scope.event = event;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n    \n    editModal = $modal({title: 'Ereignis bearbeiten', templateUrl: '/views/modern/events/editmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {};\n    }\n\n    var uploadOptions = {\n      url: 'timeline/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      fileItem.event.download = response.files[0].uploadedAs;\n    };\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n    editModal.$scope.upload = function(fileItem, event) {\n      fileItem.event = event;\n      fileItem.upload();\n    };\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/events/typechoosermodal.jade', show: false});\n    typeModal.$scope.chooseType = chooseType;\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      $log.debug(\"edit closed\", event, editModal);\n      if(editModal.$scope.ok) {\n        return validate(editModal.$scope.event, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.event);\n      }\n    });\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(event, eventBlockName, callback) {\n    // $log.debug(\"edit\", event);\n    editModal.$scope.event = event;\n    // editModal.$scope.eventBlockName = eventBlockName;\n    editModal.$scope.callback = callback;\n    editModal.$scope.ok = false;\n    focus('eventtitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var split = function(events) {\n    var unknown = [], before = [], after = [];\n    for (var i = 0; i < events.length; i++) {\n      if(angular.isDefined(events[i].to)) {\n        events[i].to = moment(events[i].to);\n      }\n      if(angular.isDefined(events[i].from)) {\n        events[i].from = moment(events[i].from);\n        if(events[i].from.isAfter()) {\n          after.push(events[i]);\n        }\n        else {\n          before.push(events[i]);\n        }\n      } else {\n        unknown.push(events[i]);\n      }\n    }\n    return {unknown:unknown, before:before, after:after};\n  };\n\n  var removeFromClient = function (events, event, eventBlockName, callback) {\n    var errors = [\n      \"no event on client site found to remove\"\n    ];\n    var index = events[eventBlockName].indexOf(event);\n    if (index > -1) {\n      events[eventBlockName].splice(index, 1);\n      if(angular.isFunction(callback)) {\n        return callback(null, events);\n      }\n      return events;\n    }\n    if(angular.isFunction(callback)) {\n      return callback(errors[0], events);\n    }\n    return errors[0];\n  };\n\n  var remove = function(events, event, eventBlockName, callback) {\n    // $log.debug(\"remove event\", event, eventBlockName);\n    if(event.id) {\n      $log.debug(event);\n      $sailsSocket.delete('/timeline/'+event.id).success(function(users, status, headers, config) {\n        removeFromClient(events, event, eventBlockName, callback);\n      });\n    } else {\n      removeFromClient(events, event, eventBlockName, callback);\n    }\n  };\n\n  var transform = function(events) {\n    events = split(events);\n    events.before = UtilityService.invertOrder(events.before);\n    return events;\n  };\n\n  var merge = function(unknown, before, after) {\n    if(angular.isUndefined(unknown)) {\n      unknown = [];\n    }\n    if(angular.isUndefined(before)) {\n      before = [];\n    }\n    if(angular.isUndefined(after)) {\n      after = [];\n    }\n    return unknown.concat(before).concat(after);\n  };\n\n  var append = function(events, event, callback) {\n    events.unknown.push(event);\n    var allEvents = merge(events.unknown, events.before, events.after);\n    events = transform(allEvents);\n    if(angular.isFunction(callback)) {\n      return callback(null, events);\n    }\n    return events;\n  };\n\n  var create = function(data) {\n    if(!data || !data.from) {\n      data.from = moment();\n      data.from.add(1, 'hours');\n      data.from.minutes(0);\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.person) {\n      data.person = \"\";\n    }\n    if(!data || !data.place) {\n      data.place = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var createEdit = function(events, event, callback) {\n    event = create(event); \n    edit(event, null, callback);\n  };\n\n  var fix = function(object, callback) {\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(eventBlocks) {\n    var allEvents = merge(eventBlocks.unknown, eventBlocks.before, eventBlocks.after);\n    // $log.debug(\"allEvents.length\", allEvents.length);\n    eventBlocks = transform(allEvents);\n    // $log.debug(\"refreshed\");\n    return eventBlocks;\n  };\n\n  var saveOne = function (eventBlocks, eventBlockName, event, callback) {\n    var errors = [\n      \"EventService: Can't save event.\",\n      \"EventService: Can't save event, event to update not found.\",\n      \"EventService: Can't save event, parameters undefind.\",\n    ];\n    if(angular.isDefined(event) && angular.isDefined(eventBlockName) && angular.isDefined(callback)) {\n      event = fix(event);\n      if(angular.isUndefined(event.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/timeline', event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event created\", event, data);\n          var index = eventBlocks[eventBlockName].indexOf(event);\n          if (index > -1) {\n            eventBlocks[eventBlockName][index] = data;\n            // $log.debug(eventBlocks[eventBlockName][index]);\n            callback(null, eventBlocks[eventBlockName][index]);\n          } else {\n            callback(errors[1]);\n          }\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/timeline/'+event.id, event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event updated\", event, data);\n          event = data;\n          callback(null, event);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      }\n    } else {\n      callback(errors[2]);\n    }\n  };\n\n  var saveAllInBlock = function(eventBlocks, eventBlockName, callback) {\n    $async.map(eventBlocks[eventBlockName], function (event, callback) {\n      saveOne(eventBlocks, eventBlockName, event, callback);\n    }, callback);\n  };\n\n\n  var saveBlocks = function(eventBlocks, callback) {\n    var errors = [\n      \"EventService: Can't save eventBlocks, parameters undefind.\"\n    ];\n    // save just this event if defined\n    if(angular.isDefined(eventBlocks) && angular.isDefined(callback)) {\n      return $async.map(['after', 'before', 'unknown'], function (eventBlockName, callback) {\n        saveAllInBlock(eventBlocks, eventBlockName, callback);\n      }, function(err, eventBlocksArray) {\n        if(err) {\n           $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n        }\n        var allEvents = merge(eventBlocksArray[0], eventBlocksArray[1], eventBlocksArray[2]);\n        eventBlocks = transform(allEvents);\n        return callback(null, eventBlocks);\n      });\n    }\n    $log.error(errors[0]);\n    if(angular.isFunction(callback)) {\n      return callback(errors[0]);\n    }\n  };\n\n  var resolve = function(page) {\n    return $sailsSocket.get('/timeline').then (function (data) {\n      // $log.debug(data);\n      return transform(data.data);\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('timeline', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            event = msg.data;\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde erstellt', msg.data.title);\n          }\n          $scope.events.before.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    subscribe: subscribe,\n    split: split,\n    merge: merge,\n    append: append,\n    transform: transform,\n    saveOne: saveOne,\n    saveAllInBlock: saveAllInBlock,\n    saveBlocks: saveBlocks,\n    edit: edit,\n    createEdit: createEdit,\n    fixEach: fixEach,\n    resolve: resolve,\n    setModals: setModals,\n    refresh: refresh,\n    openTypeChooserModal: openTypeChooserModal,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: remove\n  };\n});","angular.module('jumplink.cms.gallery', [\n  'mgcrea.ngStrap',\n  'ngAsync',\n  'angular-medium-editor',\n  'FBAngular',\n  'sails.io',\n  'angularFileUpload',\n  'jumplink.cms.sortable',\n  'jumplink.cms.content',\n])\n.service('GalleryService', function ($rootScope, $sailsSocket, $async, $filter, Fullscreen, SortableService, ContentService, FileUploader, $modal, $log) {\n\n  var editModal = null;\n  uploadModal = null;\n  fullscreenImage = null;\n\n  var dropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-eye\\\"></i>&nbsp;Anzeigen\",\n      \"click\": \"goToImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-edit\\\"></i>&nbsp;Bearbeiten\",\n      \"click\": \"editImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-trash\\\"></i>&nbsp;Löschen\",\n      \"click\": \"$dropdown.hide();$dropdown.destroy();removeImage(image);\" // TODO delay\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-floppy-o\\\"></i>&nbsp;Speichern\",\n      \"click\": \"saveImage(image)\"\n    }\n  ];\n\n  var getDropdown = function () {\n    return dropdown;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Bild bearbeiten', templateUrl: '/views/modern/gallery/editmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var prepairUploadModal = function (uploadModal, imageBlocks, contentBlocks) {\n    \n    uploadModal.$scope.imageBlocks = imageBlocks;\n    uploadModal.$scope.selects = getSelects(imageBlocks, contentBlocks);\n    if(uploadModal.$scope.selects.length > 0) {\n      $rootScope.selectedContentBlock = uploadModal.$scope.selects[0].value;\n    }\n\n    $rootScope.$watch('selectedContentBlock', function(newValue, oldValue) {\n      $log.debug(\"selected changed to\", newValue);\n    });\n\n    return uploadModal;\n  };\n\n  var setUploadModal = function($scope, imageBlocks, contentBlocks, options, callback, onCompleteCallback) {\n\n    // if options not set, set to default values\n    if(angular.isUndefined(options)) {\n      options = {\n        thumbnail: {\n          width: 300,\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'gallery/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(options)\n      }\n    };\n\n    $scope.uploader = new FileUploader(uploadOptions);\n    $scope.uploader.filters.push({\n      name: 'imageFilter',\n      fn: function(item /*{File|FileLikeObject}*/, options) {\n        var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n        return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n      }\n    });\n\n    if(angular.isFunction(onCompleteCallback)) {\n      $scope.uploader.onComplete = onCompleteCallback;\n    }\n\n    $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      //fileItem.member.image = response.files[0].uploadedAs;\n      $log.debug(\"[GalleryService.uploader.onCompleteItem]\",fileItem, response, status, headers);\n      // WORKAROUND until the socket method works\n      response.files.forEach(function (file, index, files) {\n\n        var selected = $rootScope.selectedContentBlock;\n        var imageBlocks = uploadModal.$scope.imageBlocks;\n        var currentImages = imageBlocks[selected];\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] selected\", selected, \"imageBlocks\", imageBlocks, \"currentImages\", currentImages);\n\n        var last_position = 0;\n        if(currentImages.length > 0) {\n          last_position = currentImages[currentImages.length-1].position;\n        }\n        if($rootScope.authenticated) {\n          $rootScope.pop('success', 'Ein Bild wurde hochgeladen', file.original.name);\n        }\n        if(typeof file.position === 'undefined') {\n          last_position++;\n          file.position = last_position;\n          file.content = selected;\n        }\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] file\", file);\n        \n        currentImages.push(file);\n      });\n    };\n\n    $scope.upload = function(fileItem, image) {\n      fileItem.image = image;\n      fileItem.upload();\n    };\n\n    uploadModal = $modal({scope: $scope, title: 'Bilder hinzufügen', uploader: $scope.uploader, templateUrl: '/views/modern/gallery/uploadimagesmodal.jade', show: false});\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    if(angular.isFunction(callback)) {\n      return callback(getUploadModal());\n    }\n    return getUploadModal();\n  };\n\n  var getSelects = function (imageBlocks, contentBlocks) {\n    var blockNames = Object.keys(imageBlocks);\n    var result = [];\n    // console.log(\"contentBlocks\", contentBlocks);\n    blockNames.forEach(function (blockName, index, array) {\n      var label = ContentService.getByName(contentBlocks, blockName).title || blockName; // TODO WARNING slow!\n      result.push({\n        label: label,\n        value: blockName\n      });\n    });\n    return result;\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var fix = function(image, page, contentname, callback) {\n    if(!image.page || image.page === \"\") {\n      image.page = page;\n    }\n\n    if(!image.content || image.content === \"\") {\n      image.content = contentname;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, image);\n    }\n    return image;\n  };\n\n  // var setFullScreen = function(image) {\n  //   // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  //   fullscreenImage = image;\n  // }\n\n  // var closeFullScreen = function(image) {\n  //   Fullscreen.cancel();\n  // }\n\n  // Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n  //   if(!isFullscreenEnabled) {\n  //     delete fullscreenImage;\n  //   }\n  //   $scope.$apply();\n  // });\n\n  // var isFullScreen = function(image) {\n  //   if(angular.isDefined($scope.fullscreenImage) && angular.isDefined($scope.fullscreenImage.original) && angular.isDefined($scope.fullscreenImage.original.name) && $scope.fullscreenImage.original.name == image.original.name) {\n  //     return true;\n  //   } else {\n  //     return false;\n  //   }\n  // }\n\n  var saveOne = function(image, page, contentname, callback) {\n    image = fix(image, page, contentname);\n    var errors = [\n      'Bild konnte nicht gespeichert werden'\n    ];\n    $sailsSocket.put('/gallery/'+image.id, image).success(function(data, status, headers, config) {\n      if(angular.isArray(data)) {\n        data = data[0];\n      }\n      if(angular.isFunction(callback)) {\n        callback(null, data);\n      }\n    }).\n    error(function(data, status, headers, config) {\n      $log.error (errors[0], data);\n      if(angular.isFunction(callback)) {\n        callback(errors[0], data);\n      }\n    });\n  };\n\n  var saveAllBlocks = function(imageBlocks, page, callback) {\n    var blockNames = Object.keys(imageBlocks);\n    // $log.debug(\"saveAllBlocks\",\"blockNames\" , blockNames);\n\n    $async.map(blockNames,\n    function iterator(contentname, callback) {\n      saveAll(imageBlocks[contentname], page, contentname, callback);\n    }, callback);\n\n    // $async.map(images,\n    // function iterator(image, callback) {\n    //   saveOne(image, page, contentname, callback);\n    // }, callback);\n  };\n\n  var saveAll = function(images, page, contentname, callback) {\n    $async.map(images,\n    function iterator(image, callback) {\n      saveOne(image, page, contentname, callback);\n    }, callback);\n  };\n\n  var remove = function(images, index, image, page, callback) {\n    if(typeof(index) === 'undefined' || index === null) {\n      index = images.indexOf(image);\n    }\n    images = SortableService.remove(images, index, image);\n    // if image has an id it is saved on database, if not, not\n    if(image.id) {\n      // $log.debug(\"remove from server, too\" ,image);\n      $sailsSocket.delete('/gallery/'+image.id+\"?filename=\"+image.original.name+\"&page=\"+page, {id:image.id, filename:image.original.name, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          callback(null, images);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(null, images);\n      }\n    }\n  };\n\n  var add = function(imageBlocks, contentBlocks, callback) {\n    // $log.debug(\"add\");\n    uploadModal.$promise.then(uploadModal.show);\n\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    uploadModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"upload modal closed\");\n      if(angular.isFunction(callback)) {\n        callback(null);\n      }\n    });\n  };\n\n  // Images for Content\n  var addBlock = function(imageBlocks, content, callback) {\n    imageBlocks[content.name] = [];\n    if(angular.isFunction(callback)) {\n      return callback(null, imageBlocks[content.name]);\n    }\n    return imageBlocks[content.name];\n  };\n\n  var edit = function(image, callback) {\n    $log.debug(\"edit\", image);\n    editModal.$scope.image = image;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    editModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"edit closed\");\n      if(angular.isFunction(callback)) {\n        callback(null, editModal.$scope.image);\n      }\n    });\n  };\n\n  var aspect = function (image, width)  {\n    var height, scale, aspectRatio, win, paddingTopBottom = 0, paddingLeftRight = 0;\n    if($scope.isFullScreen(image)) {\n      // customised jQuery Method of http://css-tricks.com/perfect-full-page-background-image/\n      aspectRatio = image.original.width / image.original.height;\n      win = $rootScope.getWindowDimensions();\n      if(win.width / win.height < aspectRatio) {\n        width = win.width; // width 100%\n        scale = image.original.width / width;\n        height = image.original.height / scale;\n        paddingTopBottom = (win.height - height) / 2;\n        height = win.height;\n      } else {\n        height = win.height;  // height 100%\n        scale = image.original.height / height;\n        width = image.original.width / scale;\n        paddingLeftRight = (win.width - width) / 2;\n        width = win.width;\n      }\n      return {width: width+'px', height: height+'px', 'padding-right': paddingLeftRight+\"px\", 'padding-left': paddingLeftRight+\"px\", 'padding-top': paddingTopBottom+\"px\", 'padding-bottom': paddingTopBottom+\"px\" };\n    } else {\n      scale = image.original.width / width;\n      height =  image.original.height / scale;\n      return {width: width+'px', height: height+'px'};\n    }\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('gallery', function(msg) {\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $log.debug('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n            // $rootScope.pop('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n          }\n        break;\n        case 'created':\n          // TODO not broadcast / fired why?!\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hochgeladen', msg.data.original.name);\n          }\n          $scope.images.push(msg.data);\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde entfernt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n        case 'destroyed':\n          // if($rootScope.authenticated) {\n          //   $rootScope.pop('success', 'Ein Bild wurde gelöscht', \"\");\n          // }\n          $log.debug(msg.data);\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hinzugefügt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n      }\n    });\n  };\n\n  var resolve = function(page, content) {\n    var url = '/gallery?limit=0&page='+page;\n    if(content) {\n      url = url+'&content='+content;\n    }\n    return $sailsSocket.get(url).then (function (data) {\n      return $filter('orderBy')(data.data, 'position');\n    }, function error (resp) {\n      $log.error(resp);\n    });\n  };\n\n  return {\n    getDropdown: getDropdown,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    setUploadModal: setUploadModal,\n    getUploadModal: getUploadModal,\n    saveOne: saveOne,\n    saveAll: saveAll,\n    saveAllBlocks: saveAllBlocks,\n    remove: remove,\n    add: add,\n    addBlock: addBlock,\n    edit: edit,\n    aspect: aspect,\n    subscribe: subscribe,\n    resolve: resolve\n  };\n});","angular.module('ngFocus', [])\n// Source and Copyright: http://stackoverflow.com/questions/25596399/set-element-focus-in-angular-way\n.factory('focus', function($timeout, $window) {\n  return function(id) {\n    // timeout makes sure that it is invoked after any other event has been triggered.\n    // e.g. click events that need to run before the focus or\n    // inputs elements that are in a disabled state but are enabled when those events\n    // are triggered.\n    $timeout(function() {\n      var element = $window.document.getElementById(id);\n      if(element) {\n        element.focus();\n      }\n    });\n  };\n})\n.directive('eventFocus', function(focus) {\n  return function(scope, elem, attr) {\n    elem.on(attr.eventFocus, function() {\n      focus(attr.eventFocusId);\n    });\n\n    // Removes bound events in the element itself\n    // when the scope is destroyed\n    scope.$on('$destroy', function() {\n      elem.off(attr.eventFocus);\n    });\n  };\n});","angular.module('jumplink.cms.bootstrap.importexport', [\n  'jumplink.cms.importexport',\n  'jumplink.cms.bootstrap.uploader',\n  'mgcrea.ngStrap',\n  'ngFocus',\n])\n\n.service('ImportExportBootstrapService', function ($log, focus, $modal, FileUploader) {\n\n  var uploadModal = null;\n  \n\n  /**\n   * Setup the upload modal\n   */\n  var setModals = function($scope, fileOptions, onCompleteItemCallback, onImportStart, onAbort, onImportFinsih) {\n\n    uploadModal = $modal({title: 'JSON importieren', templateUrl: '/views/modern/uploadmodal.bootstrap.jade', show: false});\n    uploadModal.$scope.fileOptions = fileOptions;\n    uploadModal.$scope.imports = [];\n\n    uploadModal.$scope.ok = false;\n    uploadModal.$scope.import = function (hide) {\n      uploadModal.$scope.ok = true;\n\n      if(angular.isFunction(onImportStart)) {\n        onImportStart(uploadModal.$scope.imports, function (err, results) {\n          if(angular.isFunction(onImportFinsih)) {\n            onImportFinsih(err, results);\n          }\n          uploadModal.$scope.imports = [];\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onImportStart is not defined!\");\n        uploadModal.$scope.imports = [];\n        hide();\n      }\n\n    };\n    uploadModal.$scope.abort = function (hide) {\n      uploadModal.$scope.ok = false;\n      uploadModal.$scope.imports = [];\n\n      if(angular.isFunction(onAbort)) {\n        onAbort(uploadModal.$scope.imports, function (err) {\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onAbort is not defined!\");\n        hide();\n      }\n\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(uploadModal.$scope.fileOptions)) {\n      uploadModal.$scope.fileOptions = {};\n    }\n\n    uploadModal.$scope.uploadOptions = {\n      url: 'importexport/upload',\n      removeAfterUpload: true,\n      alias: 'import',\n\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(uploadModal.$scope.fileOptions)\n      }\n    };\n\n    uploadModal.$scope.onCompleteItem = function (err, files) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteItem]\");\n      if(angular.isFunction(onCompleteItemCallback)) {\n        onCompleteItemCallback(err, files);\n      }\n    };\n    uploadModal.$scope.onCompleteAll = function (err, result) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteAll]\");\n    };\n\n    // uploadModal.$scope.uploader = new FileUploader($scope.uploadOptions);\n\n\n    uploadModal.$scope.upload = function(fileItem) {\n      fileItem.upload();\n    };\n\n    uploadModal.$scope.$on('modal.hide.before',function(modalEvent, uploadModal) {\n      $log.debug(\"edit closed\", uploadModal.$scope, uploadModal);\n      if(uploadModal.$scope.ok) {\n\n        uploadModal.$scope.callback(null, uploadModal.$scope);\n      } else {\n        if(uploadModal.$scope.callback) {\n          uploadModal.$scope.callback(\"discarded\", uploadModal.$scope);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var getModals = function() {\n    return {\n      uploadModal: getUploadModal(),\n    };\n  };\n\n  /**\n   * Show the upload modal to upload files\n   */\n  var show = function(callback) {\n    $log.debug(\"[BlogService.show]\");\n    uploadModal.$scope.callback = callback;\n    uploadModal.$scope.ok = false;\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    uploadModal.$promise.then(uploadModal.show);\n  };\n\n  var setImports = function (data, options) {\n    uploadModal.$scope.imports = uploadModal.$scope.imports.concat(data);\n    for (var i = uploadModal.$scope.imports.length - 1; i >= 0; i--) {\n      uploadModal.$scope.imports[i].importOptions = {\n        doImport: true,\n        identifier: uploadModal.$scope.imports[i][options.identifierKey],\n        description: uploadModal.$scope.imports[i][options.descriptionKey],\n      };\n    }  \n  };\n\n  return {\n    show: show,\n    setModals: setModals,\n    setImports: setImports,\n  };\n});","angular.module('jumplink.cms.importexport', [\n  'jumplink.cms.attachment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('ImportExportService', function ($sailsSocket, $async, $log, $filter) {\n\n\n  return {\n\n  };\n});","angular.module('jumplink.cms.history', [\n  'ui.router',\n])\n/**\n * @see: https://github.com/angular-ui/ui-router/issues/92\n */\n.service('HistoryService', function ($window, $location, $state, $anchorScroll, $timeout, $log) {\n  var history = [];\n  var push = function(state, params) {\n    history.push({ state: state, params: params });\n  };\n\n  var all = function() {\n    return history;\n  };\n\n  var go = function(step) {\n    $log.debug('[jumplink.cms.history.HistoryService], history.length', history.length, 'step', step, 'history.length + step =', history.length + step);\n    // If the past has not been saved as far as the steps that we want to go back, then go to the beginning of time\n    if(history.length + step <= 0) {\n     return $location.path('/');\n    }\n    // TODOlocation    // (1) Determine # of states in stack with URLs, attempt to\n    //    shell out to $window.history when possible\n    // (2) Attempt to figure out some algorthim for reversing that,\n    //     so you can also go forward\n    var prev = this.previous(step || -1);\n    return $state.go(prev.state, prev.params);\n  };\n\n  var previous = function(step) {\n    return history[history.length - Math.abs(step || 1)];\n  };\n\n  var back = function() {\n    return this.go(-1);\n  };\n\n  var goToHashPosition = function (hash) {\n    // $log.debug(\"go to hash\", hash);\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  var autoScroll = function () {\n    var hash = $location.hash();\n    // $log.debug(\"hash\", hash);\n    if(hash) {\n      // WORKAROUND\n      $timeout(function(){ goToHashPosition(hash); }, 1000); // TODO smooth?\n    } else {\n      $anchorScroll();\n    }    \n  };\n\n  return {\n    push: push,\n    all: all,\n    go: go,\n    previous: previous,\n    back: back,\n    goToHashPosition: goToHashPosition,\n    autoScroll: autoScroll\n  };\n\n})\n.run(function(HistoryService, $state, $rootScope) {\n\n  $rootScope.$on(\"$stateChangeSuccess\", function(event, to, toParams, from, fromParams) {\n    if (!from.abstract) {\n      HistoryService.push(from, fromParams);\n    }\n  });\n  console.log(HistoryService);\n  HistoryService.push($state.current, $state.params);\n\n});","angular.module('jumplink.cms.info', [\n  'sails.io',\n])\n\n.service('CmsService', function ($log, $sailsSocket) {\n\n  var info = function(url, callback) {\n    var errors = [\n      \"[CmsService] Error: On trying to get cms info, url: \"+url,\n      \"[CmsService] Error: Result is null, url: \"+url\n    ];\n    var warns = [\n      \"[CmsService] Warn: Request has more than one results, url: \"+url\n    ];\n    return $sailsSocket.get(url).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        if(angular.isFunction(callback)) {\n          return callback(errors[1]);\n        }\n        return null;\n      }\n      if (data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.warn(warns[0]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  // CMS Info for Users\n  var infoUser = function(callback) {\n    return info('/cms/infouser', callback);\n  };\n\n  var infoAdmin = function(callback) {\n    return info('/cms/infoadmin', callback);\n  };\n\n  var restart = function(callback) {\n    return $sailsSocket.post('/cms/restart').then (function (data) {\n      $log.debug(\"[CmsService.restart]\", data);\n      return callback(null, data);\n    }, function error (resp){\n      $log.error(\"[CmsService.restart]\", resp);\n      return callback(resp);\n    });\n  };\n\n\n  /**\n   * Public functions\n   */\n  return {\n    infoUser: infoUser,\n    infoAdmin: infoAdmin,\n    restart: restart,\n  };\n});","angular.module('jumplink.cms.multisite', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('MultisiteService', function ($rootScope, JLSailsService, $log) {\n\n  var resolve = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolve]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/find', query, options, callback);\n  };\n\n  var resolveNames = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findnames', query, options, callback);\n  };\n\n  var resolveHosts = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findhosts', query, options, callback);\n  };\n\n  return {\n    resolve: resolve,\n    resolveNames: resolveNames,\n    resolveHosts: resolveHosts\n  };\n});","angular.module('jumplink.cms.bootstrap.routes', [\n  'jumplink.cms.routes',\n  'jumplink.cms.bootstrap.importexport',\n])\n.service('RoutesBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, RoutesService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[RoutesBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'objectName', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          RoutesService.updateOrCreateByHostByObjectNameAndNavbar(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[RoutesBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n\n});","angular.module('jumplink.cms.routes', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'jumplink.cms.sails',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'ngDownload'\n])\n.provider('jlRoutes', function jlRoutesProvider($stateProvider, $urlRouterProvider, $locationProvider) {\n\n  this.html5Mode = $locationProvider.html5Mode;\n\n  this.otherwise = $urlRouterProvider.otherwise;\n\n  this.state = $stateProvider.state;\n\n  this.when = function (url1, url2) {\n    $urlRouterProvider.when(url1, url2);\n  };\n\n  this.setLayouts = function(layouts) {\n    for (var stateName in layouts ) {\n      this.state(stateName, layouts[stateName]);\n    }\n  };\n\n  this.setRoutes = function(routes, routeOptions) {\n    /**\n     * Load optional addional states.\n     * WARNING: Very experimental and dangerous.\n     */\n    for (var i = 0; i < routes.length; i++) {\n      // if is Main Route\n      if(routes[i].main) {\n        var options = {};\n        // set state main url\n        if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n          options.url = routes[i].url;\n        }\n        // WARNING custom states are very experimental\n        if(routes[i].customstate === true) {\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.resolve) && typeof(routes[i].state.resolve) === 'string' && routes[i].state.resolve.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.resolve);\n            /* jshint ignore:end */\n            options.resolve = resolve;\n          }\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.views) && typeof(routes[i].state.views) === 'string' && routes[i].state.views.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.views);\n            /* jshint ignore:end */\n            options.views = view;\n          }\n        // states wich are defined in routeOptions\n        } else {\n          // set state options\n          if(angular.isDefined(routes[i].objectName) && angular.isDefined(routeOptions[routes[i].objectName])) {\n            // console.log(routeOptions[routes[i].objectName]);\n            if(angular.isObject(routeOptions[routes[i].objectName].resolve)) {\n              options.resolve = routeOptions[routes[i].objectName].resolve;\n            }\n            if(angular.isObject(routeOptions[routes[i].objectName].views)) {\n              options.views = routeOptions[routes[i].objectName].views;\n            }\n            \n          } else {\n            console.error(\"objectName \"+routes[i].objectName+\" not found for route \"+routes[i]);\n          } \n        }\n        // If options are set, init state\n        if(angular.isDefined(options.url) && angular.isDefined(options.views)) {\n          // console.log(\"New Route\", routes[i].state.name, options);\n          $stateProvider.state(routes[i].state.name, options);\n        }\n        //set alternative urls as redirects\n        if(angular.isArray(routes[i].alternativeUrls)) {\n          for (var a = 0; a < routes[i].alternativeUrls.length; a++) {\n            // e.g. $urlRouterProvider.when('/referenzen', '/referenzen/uebersicht');\n            console.log(\"New redirect: \"+routes[i].alternativeUrls[a]+\" -> \"+routes[i].url);\n            $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n          }\n        }\n      } else {\n        // if route is not a main route\n        // if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n        //   options.url = routes[i].url;\n        //   $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n        // }\n        \n      }\n    }\n  };\n\n\n  this.$get = function jlRoutesFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlRoutes();\n  };\n})\n.filter('showOnlyMainRoutes', function() {\n  // In the return function, we must pass in a single parameter which will be the data we will work on.\n  // We have the ability to support multiple other parameters that can be passed into the filter optionally\n  return function(routes, active) {\n    if(active !== true) {\n      return routes;\n    }\n    var result = [];\n    for (var i = 0; i < routes.length; i++) {\n      if(routes[i].main === true) {\n        result.push(routes[i]);\n      }\n    }\n    return result;\n  };\n})\n.service('RoutesService', function ($rootScope, $download, JLSailsService, $log, SortableService, UtilityService) {\n\n  var create = function(data) {\n    $log.debug(\"[RoutesService.create] data\", data);\n    if(!angular.isObject(data)) {\n      data = {};\n    }\n    if(!angular.isString(data.match)) {\n      data.match = \"\";\n    }\n    if(!angular.isString(data.title)) {\n      data.title = \"\";\n    }\n    if(data.main !== true && data.main !== false) {\n      data.main = false;\n    }\n    if(!angular.isString(data.url)) {\n      data.url = \"\";\n    }\n    if(!angular.isArray(data.alternativeUrls)) {\n      data.alternativeUrls = [];\n    }\n    if(angular.isUndefined(data.state) || !angular.isObject(data.state)) {\n      data.state = {};\n    }\n    if(!angular.isString(data.state.name)) {\n      data.state.name = \"\";\n    }\n    if(data.state.customstate !== true && data.state.customstate !== false) {\n      data.state.customstate = false;\n    }\n    if(!angular.isString(data.state.url)) {\n      data.state.url = \"\";\n    }\n    if(!angular.isString(data.state.views)) {\n      data.state.views = \"\";\n    }\n    if(!angular.isString(data.state.resolve)) {\n      data.state.resolve = \"\";\n    }\n    if(!angular.isObject(data.fallback)) {\n      data.fallback = {};\n    }\n    if(!angular.isString(data.fallback.url)) {\n      data.fallback.url = \"\";\n    }\n    return data;\n  };\n\n  var append = function(routes, data, callback) {\n    $log.debug(\"[RoutesService] data before\", data);\n    data = create(data);\n    $log.debug(\"[RoutesService] data after\", data);\n    SortableService.append(routes, data, callback);\n  };\n\n  var swap = function(routes, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, routes, callback) {\n    return SortableService.moveForward(index, routes, callback);\n  };\n\n  var moveBackward = function(index, routes, callback) {\n    return SortableService.moveBackward(index, routes, callback);\n  };\n\n  var removeFromClient = function (routes, index, route, callback) {\n    if(angular.isFunction(callback)) {\n      return SortableService.remove(routes, index, route, callback);\n    }\n    return SortableService.remove(routes, index, route);\n  };\n\n  var remove = function(routes, index, route, callback) {\n    if((angular.isUndefined(route) || route === null) && angular.isDefined(index)) {\n      route = routes[index];\n    }\n    if(angular.isUndefined(index) || index === null) {\n      index = routes.indexOf(route);\n    }\n    routes = removeFromClient(routes, index, route);\n    // if route has an id it is saved on database, if not, not\n    if(route.id) {\n      $log.debug(\"[RoutesService.remove] remove from server, too\", route);\n      var options = {\n        method: 'delete',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/routes/destroy/'+route.id, {id:route.id}, options, callback);\n    }\n  };\n\n  var find = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/routes/find', query, options, callback);\n  };\n\n  var findOne = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/routes/findOne', query, options, callback);\n  };\n\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Routes/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[RoutesService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"routes.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create route (eg. position) for current host.\n   */\n  var updateOrCreate = function(route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreate]\", route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreate', {route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHostByObjectNameAndNavbar = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHostByObjectNameAndNavbar', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHost = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHost]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHost', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for current host.\n   */\n  var updateOrCreateEach = function(routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEach]\", routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEach', {routes: routes}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateEachByHost = function(host, routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEachByHost]\", host, routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEachByHost', {host: host, routes: routes}, options, callback);\n  };\n\n  var generateObjectnameFromStatename = function (statename) {\n    $log.debug(\"[RoutesController.generateObjectnameFromStatename]\", statename);\n    var objectname = \"\";\n    var keys = statename.split('.');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    return objectname;\n  };\n\n  var generateObjectnameFromUrl = function (url) {\n    var objectname = \"\";\n    var keys = url.split('/');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    $log.debug(\"[RoutesController.generateObjectnameFromUrl]\", url, keys, objectname, objectname.length);\n    return objectname;\n  };\n\n  return {\n    create: create,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    destroy: remove, // Alias\n    find: find,\n    findOne: findOne,\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreate: updateOrCreate,\n    updateOrCreateByHostByObjectNameAndNavbar: updateOrCreateByHostByObjectNameAndNavbar,\n    updateOrCreateByHost: updateOrCreateByHost,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    saveEachByHost: updateOrCreateEachByHost, // Alias\n    generateObjectnameFromStatename: generateObjectnameFromStatename,\n    generateObjectnameFromUrl: generateObjectnameFromUrl,\n  };\n});","angular.module('jumplink.cms.sails', [\n    'sails.io',\n  ])\n\n  .service('JLSailsService', function ($rootScope, $sailsSocket, $q, $log) {\n\n    var resolve = function(url, query, options, callback, next) {\n      var deferred = $q.defer();\n      var errors = [\n        \"On trying to resolve \"+url,\n        \"Request has more than one results\",\n        \"No result\"\n      ];\n      if(angular.isUndefined(options)) {\n        options = {};\n      }\n      if(angular.isUndefined(options.method)) {\n        options.method = 'get';\n      }\n      if(angular.isUndefined(options.resultIsArray)) {\n        options.resultIsArray = false;\n      }\n      if(angular.isUndefined(query)) {\n        query = {};\n      }\n      // $log.debug(\"[JLSailsService.resolve]\", url, query, options);\n      $sailsSocket[options.method](url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          if(angular.isFunction(callback)) {\n            return callback(null, null);\n          }\n          return deferred.resolve(null);\n        }\n        if (!options.resultIsArray && angular.isArray(data.data)) {\n          data.data = data.data[0];\n          $log.warn(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        }\n        return deferred.resolve(data.data);\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return deferred.reject(errors[0]);\n      });\n      return deferred.promise;\n    };\n    return {\n      resolve: resolve,\n    };\n  })\n;","angular.module('jumplink.cms.session', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('SessionService', function ($rootScope, JLSailsService, $sailsSocket, $q, $log) {\n\n  var create = function(user, callback) {\n    $log.debug(\"[SessionService.create]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/create', user, options, callback);\n  };\n\n  var destroy = function(user, callback) {\n    $log.debug(\"[SessionService.destroy]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/destroy', user, options, callback);\n  };\n\n  /**\n   * Check if user is authentication in current cms session\n   * Used if you need authentication conditions\n   */\n  var isAuthenticated = function (callback) {\n    $log.log(\"[SessionService.isauthenticated]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/authenticated').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in, throws an error message if your are not authenticated\n   */\n  var needToBeAuthenticated = function () {\n    $log.log(\"[SessionService.needToBeAuthenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/authenticated').then (function (data) {\n      if (data.data) {\n        $log.log(\"is authenticated\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not authenticated\", data);\n        return deferred.reject('You need to be logged in');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Check if authentifcated user is blogger or better\n   */\n  var bloggerOrBetter = function (callback) {\n    $log.log(\"[SessionService.bloggerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/bloggerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if cms is in developer mode or session user is better than that\n   */\n  var developerOrBetter = function (callback) {\n    $log.log(\"[SessionService.developerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/developerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is siteadmin or better\n   */\n  var siteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.siteadminOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is superadmin\n   */\n  var superadmin = function (callback) {\n    $log.log(\"[SessionService.superadmin]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/superadmin').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee\n   */\n  var employee = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employee').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee or better\n   */\n  var employeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user employee or better, throws an error message if your are not employee or better\n   */\n  var needToBeEmployeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is employeeOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an employee or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user is admin or better, throws an error message if your are not employee or better\n   */\n  var needToBeSiteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is siteadminOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an admin or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n  /**\n   * \n   */\n  var getAllPolicies = function (callback) {\n    $log.log(\"[SessionService.getAllPolicies]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getAllPolicies').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Get logged in user\n   */\n  var getUser = function (callback) {\n    $log.log(\"[SessionService.getUser]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getUser').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  return {\n    create: create,\n    destroy: destroy,\n    authenticated: needToBeAuthenticated, //alias TODO remove\n    needToBeAuthenticated: needToBeAuthenticated,\n    isAuthenticated: isAuthenticated, // TODO rename to authenticated\n    bloggerOrBetter: bloggerOrBetter,\n    developerOrBetter: developerOrBetter,\n    siteadminOrBetter: siteadminOrBetter,\n    superadmin: superadmin,\n    employee: employee,\n    employeeOrBetter: employeeOrBetter,\n    needToBeEmployeeOrBetter: needToBeEmployeeOrBetter,\n    needToBeSiteadminOrBetter: needToBeSiteadminOrBetter,\n    getAllPolicies: getAllPolicies,\n    getUser: getUser\n  };\n});","angular.module('jumplink.cms.sortable', [\n    'jumplink.cms.utilities'\n  ])\n  .service('SortableService', function (UtilityService, $log, $filter) {\n    var resetPosition = function (array) {\n      for (var i = array.length - 1; i >= 0; i--) {\n        array[i].position = i+1;\n      }\n      return array;\n    };\n\n    var sort = function(objects) {\n      return $filter('orderBy')(objects, 'position');\n    };\n\n    /*\n     * Swap two elements within the object array (called objects) and adjust the position\n     */\n    var swap = function(objects, index_1, index_2, cb) {\n\n      var object_1 = objects[index_1];\n      var object_2 = objects[index_2];\n\n      // swap position too\n      var position_tmp = object_1.position;\n      object_1.position = object_2.position;\n      object_2.position = position_tmp;\n\n      // IMPORTANT: swap Indexes, too\n      objects[index_1] = object_2;\n      objects[index_2] = object_1;\n\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * Insert new object to position and move the underlying objects one index back\n     * http://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n     */\n    var move = function (array, old_index, new_index, cb) {\n      $log.debug(\"[SortableService] move\");\n\n      if (new_index >= array.length) {\n          var k = new_index - array.length;\n          while ((k--) + 1) {\n              array.push(undefined);\n          }\n      }\n      array.splice(new_index, 0, array.splice(old_index, 1)[0]);\n\n      array = resetPosition(array);\n\n      if(angular.isFunction(cb)) {\n        cb(null, array);\n      }\n      return array;\n    };\n\n    /*\n     * Append a new object to array, check unique key value if set\n     */\n    var append = function(objects, data, cb, unique, uniqueKey) {\n      $log.debug(\"[SortableService.append] data\", data);\n      var errors = [\n        \"Unique key '\"+uniqueKey+\"' already exist\"\n      ];\n      var new_index = objects.length;\n      var new_position = 1;\n      var new_object;\n      var uniqueIndex = -1;\n\n      var okay = function (new_object, objects, new_index, cb) {\n        // $log.debug(\"old objects\", objects);\n        objects.push(new_object);\n        // $log.debug(\"new objects\", objects);\n        if(angular.isFunction(cb)) {\n          return cb(null, objects, new_index);\n        }\n        return objects;\n      };\n\n      var error = function (error, objects, uniqueIndex, cb) {\n        if(angular.isFunction(cb)) {\n          return cb(error, objects, uniqueIndex);\n        }\n        return error;\n      };\n\n      if(new_index >= 1) {\n        new_position = objects[new_index-1].position+1;\n      }\n\n      new_object = {\n        position: new_position,\n      };\n\n      new_object = angular.extend(new_object, data);\n      $log.debug(\"[SortableService.append] new_object\", new_object);\n\n      if(unique && new_object[uniqueKey]) {\n        uniqueIndex = UtilityService.findKeyValue(objects, uniqueKey, new_object[uniqueKey]);\n        if(uniqueIndex > -1) {\n          return error(errors[0], objects, uniqueIndex, cb);\n        } else {\n          return okay(new_object, objects, new_index, cb);\n        }\n      } else {\n        return okay(new_object, objects, new_index, cb);\n      }\n    };\n\n    /*\n     * removed object from an array and adds it in another\n     */\n    var moveObjectToAnotherArray = function(object, index_from, array_from, array_to, cb, replaceData) {\n      var errors = [\n        \"[SortableService] Error: Function parameters not correctly set\"\n      ];\n\n      var errorParamsNotSet = function () {\n        $log.error(errors[0], object, index_from, array_from, array_to);\n        return cb(errors[0]);\n      };\n\n      if(object === null) {\n        object = array_from[index_from];\n      } else if (index_from === null) {\n        index_from = array_from.indexOf(object);\n      } else {\n        errorParamsNotSet();\n      }\n\n      if(!angular.isArray(array_from) || !angular.isArray(array_to)) {\n        errorParamsNotSet();\n      }\n\n      append(array_to, object, function (err, array_to, index_to) {\n        if(err) {\n          return cb(err);\n        }\n        remove(array_from, index_from, object, function (err, array_from) {\n          if(err) {\n            return cb(err);\n          }\n          return cb(null, {index_from: index_from, array_from: array_from, index_to:index_to, array_to: array_to });\n        });\n      }, false );\n    };\n\n    var moveForward = function(index, objects, cb) {\n      if(index + 1 < objects.length ) {\n        return swap(objects, index, index+1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move forward, index is the last element.\", objects);\n      }\n      return objects;\n    };\n\n    var moveBackward = function(index, objects, cb) {\n      if(index - 1 >= 0) {\n        return swap(objects, index, index-1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move backward, index is the first element.\", objects);\n      }\n      return objects;\n    };\n\n    var remove = function (objects, index, object, cb) {\n      if(typeof(index) === 'undefined' || index === null) {\n        index = objects.indexOf(object);\n      }\n      // $log.debug(\"remove from client\", index, object);\n      if (index > -1) {\n        objects.splice(index, 1);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /*\n     * Function for Drag and Drop functionality.\n     * Moves an moveable element with the moveFunction (e.g. to swap or insert the obkect).\n     * Usually called when the mouse button is released over an existing moveable element.\n     */\n    var dropMove = function(objects, dropObjectIndex, dragObject, event, cb, moveFunction) {\n      if(!moveFunction) {\n        moveFunction = move; // swap | move\n      }\n      var dragObjectIndex = objects.indexOf(dragObject);\n      var dropObject = objects[dropObjectIndex];\n      $log.debug(\"[SortableService] dropMove, dragObject:\", dragObject, \"dragObjectIndex\", dragObjectIndex, \"dropObject\", dropObject, \"dropObjectIndex\", dropObjectIndex);\n      return moveFunction(objects, dragObjectIndex, dropObjectIndex, cb);\n    };\n\n    return {\n      resetPosition: resetPosition,\n      sort: sort,\n      swap: swap,\n      moveObjectToAnotherArray: moveObjectToAnotherArray,\n      move: move,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      remove: remove,\n      append: append,\n      dropMove: dropMove,\n    };\n  })\n\n;","angular.module('jumplink.cms.sidebar', [\n    'mgcrea.ngStrap.aside',\n  ])\n\n  .directive('jlSidebar', function ($compile, $window) {\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      templateUrl: '/views/modern/sidebar.jade',\n      scope: {\n        routes: \"=\",\n        title: \"=\" \n      },\n      link: function ($scope, $element, $attrs) {\n        \n      }\n    };\n  });","angular.module('jumplink.cms.bootstrap.signin', [\n    'mgcrea.ngStrap',\n    'jumplink.cms.signin'\n  ])\n\n  .service('SigninBootstrapService', function ($rootScope, SigninService, $log, $modal) {\n    var siginWithModal = function(title, goBackAfterSignin, extendRoles, scope, callback) {\n      $log.debug(\"[SigninBootstrapService.siginWithModal]\", title, goBackAfterSignin, extendRoles);\n\n      if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n        callback = goBackAfterSignin;\n        goBackAfterSignin = false;\n      }\n\n      if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n        callback = extendRoles;\n        extendRoles = false;\n      }\n\n      if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n        callback = scope;\n        scope = null;\n      }\n\n      var signinModal = $modal({title: title, templateUrl: '/views/modern/signin.bootstrap.modal.jade', show: false});\n      signinModal.$scope.aborted = false;\n      signinModal.$scope.result = null;\n      signinModal.$scope.user = {\n        email: \"\",\n        password: \"\"\n      };\n      // signinModal.$scope.goBackAfterSignin = goBackAfterSignin === true;\n\n      signinModal.$scope.abort = function (user) {\n        signinModal.$scope.aborted = true;\n      };\n\n      signinModal.$scope.signin = function (user) {\n        $log.debug(\"[SigninBootstrapService.siginWithModal.signin]\", user);\n        SigninService.signin(user, goBackAfterSignin, extendRoles, scope, function (error, result) {\n          if(error) {\n            signinModal.$scope.error = error;\n            return signinModal.$scope.error;\n          }\n          signinModal.$scope.result = result;\n          // $rootScope.\n          $log.debug(result);\n        });\n      };\n\n      signinModal.$scope.$on('modal.hide',function(){\n        $log.debug(\"signin modal closed\");\n        if(angular.isFunction(callback)) {\n          callback(signinModal.$scope.error, signinModal.$scope.result, signinModal.$scope.user);\n        }\n      });\n\n      signinModal.$promise.then(signinModal.show);\n    };\n\n    return {\n      siginWithModal: siginWithModal\n    };\n  })\n;","angular.module('jumplink.cms.signin', [\n  'jumplink.cms.session',\n  'jumplink.cms.history',\n  'ngAsync'\n])\n.service('SigninService', function (SessionService, $log, HistoryService, $async) {\n\n\n  var getRoles = function (scope, callback) {\n    $async.parallel({\n      authenticated: function(callback) {\n        SessionService.isAuthenticated(callback);\n      },\n      bloggerOrBetter: function(callback) {\n        SessionService.bloggerOrBetter(callback);\n      },\n      siteadminOrBetter: function(callback) {\n        SessionService.siteadminOrBetter(callback);\n      },\n      employeeOrBetter: function(callback) {\n        SessionService.employeeOrBetter(callback);\n      }\n    },\n    callback);\n  };\n\n  var signin = function (user, goBackAfterSignin, extendRoles, scope, callback) {\n    if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n      callback = goBackAfterSignin;\n      goBackAfterSignin = false;\n    }\n\n    if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n      callback = extendRoles;\n      extendRoles = false;\n    }\n\n    if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n      callback = scope;\n      scope = null;\n    }\n\n    $log.debug(\"[SigninService.signin]\", user);\n    // $scope.user.role = 'superadmin';\n    SessionService.create(user, function (err, result) {\n      if(err) {\n        return callback(err);\n      }\n      if(!result.authenticated) {\n        return null;\n      }\n      if(extendRoles === true) {\n        SessionService.getAllPolicies(function (err, results) {\n          if(err) {\n            return callback(err);\n          }\n          $log.debug(\"scope before extend\", scope);\n          angular.extend(scope, results);\n          $log.debug(\"scope after extend\", scope);\n          if(goBackAfterSignin === true) {\n            HistoryService.back();\n          }\n        });\n      }\n      if(goBackAfterSignin === true) {\n        HistoryService.back();\n      }\n\n      $log.debug(\"[SigninService.signin]\", user);\n      $log.debug(\"[SigninService.signin] err result\", err, result);\n      return callback(null, result);\n    });\n  };\n  return {\n    signin: signin\n  };\n});","angular.module('jumplink.cms.theme', [\n  'sails.io',\n  'ngAsync',\n  'jumplink.cms.sails',\n])\n\n.service('ThemeService', function ($rootScope, $sailsSocket, $log, $async, JLSailsService) {\n  var isSubscribed = false;\n\n  /**\n   * find themes for current host from database and isert priority from database (or from local.json if no priority is set).\n   * @see CMS.ThemesController.find\n   */\n  var find = function(query, callback) {\n    $log.debug(\"[ThemeService.find]\", query);\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/find', query, options, callback);\n  };\n\n  /**\n   * find themes for any host from database and isert priority from database (or from local.json if no priority is set).\n   * Only for superadmins!\n   */\n  var findByHost = function(host, callback) {\n    // $log.debug(\"[ThemeService.findByHost]\", host);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/findbyhost', {host: host}, options, callback);\n  };\n\n  var save = function (themes, callback) {\n    updateOrCreateEach(themes, function (err, result) {\n      if(angular.isDefined(callback)) {\n        callback(err, result);\n      }\n    });\n  };\n  \n  var updateOrCreateEach = function(themes, callback) {\n    $log.debug(\"[ThemeService.updateOrCreateEach]\", themes);\n    // $sailsSocket.put('/Theme/updateOrCreateEach', {themes: themes}).success(function(data, status, headers, config) {\n    //   $log.debug(data, status, headers, config);\n    //   callback(data, status, headers, config)\n    // });\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEach', {themes: themes}, options, callback);\n  };\n\n  var updateOrCreateEachByHost = function(host, themes, callback) {\n    // $log.debug(\"[ThemeService.updateOrCreateEachByHost]\", host, themes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEachByHost', {host: host, themes: themes}, options, callback);\n  };\n\n  // TODO\n  var subscribe = function () {\n    if(!isSubscribed) {\n      $sailsSocket.subscribe('theme', function(msg){\n        if($rootScope.authenticated) {\n          $log.debug(msg);\n        }\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurdne aktualisiert', msg.data);\n            }\n          break;\n          case 'created':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden erstellt', msg.data);\n            }\n          break;\n          case 'removedFrom':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden entfernt', \"\");\n            }\n          break;\n          case 'destroyed':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden gelöscht', \"\");\n            }\n          break;\n          case 'addedTo':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden hinzugefügt', \"\");\n            }\n          break;\n        }\n      });\n      isSubscribed = true;\n    }\n  };\n\n  return {\n    find: find,\n    findByHost: findByHost,\n    save: save,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    subscribe: subscribe\n  };\n});","angular.module('jumplink.cms.subnavigation', [\n  'mgcrea.ngStrap',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities'\n])\n\n.service('SubnavigationService', function ($rootScope, $window, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n  var editModal = null;\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Navigation bearbeiten', templateUrl: '/views/modern/editsubnavigationmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('navigation', function(msg){\n      $log.debug(\"[SubnavigationService] Navigation event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Navigation wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  var resizeOnImagesLoaded = function () {\n    angular.element($window).imagesLoaded(function() {\n      angular.element($window).triggerHandler('resize');\n    });\n  };\n\n  var create = function(data) {\n    if(!data || !data.target) {\n      data.target = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.page) {\n      cb(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(navs, data, cb) {\n\n    data = create(data);\n\n    // $log.debug(\"[SubnavigationService] data\", data);\n\n    SortableService.append(navs, data, cb);\n  };\n\n  var swap = function(navs, index_1, index_2, cb) {\n    return SortableService.swap(contents, index_1, index_2, cb);\n  };\n\n  var moveForward = function(index, navs, cb) {\n    return SortableService.moveForward(index, navs, cb);\n  };\n\n  var moveBackward = function(index, navs, cb) {\n    return SortableService.moveBackward(index, navs, cb);\n  };\n\n  var edit = function(navs, cb) {\n    // $log.debug(\"[SubnavigationService] edit subnavigations\", navs);\n    editModal.$scope.navs = navs;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    if(angular.isDefined(editModal.$scope.navs) && editModal.$scope.navs.length > 0) {\n      var index = Number(editModal.$scope.navs.length-1);\n      // $log.debug(\"[SubnavigationService] focus last subnavigationeditname\", index);\n      focus('subnavigationeditname'+index);\n    }\n\n    editModal.$scope.$on('modal.hide',function(){\n      // $log.debug(\"[SubnavigationService] edit navigation modal closed\");\n      cb(null, editModal.$scope.navs);\n    });\n  };\n\n  var removeFromClient = function (navs, index, nav, cb) {\n    if(angular.isFunction(cb)) {\n      return SortableService.remove(navs, index, nav, cb);\n    }\n    return SortableService.remove(navs, index, nav);\n  };\n\n  var remove = function(navs, index, nav, page, cb) {\n\n    if((angular.isUndefined(nav) || nav === null) && angular.isDefined(index)) {\n      nav = navs[index];\n    }\n\n    if(angular.isUndefined(index) || index === null) {\n      index = navs.indexOf(nav);\n    }\n\n    navs = removeFromClient(navs, index, nav);\n    // if nav has an id it is saved on database, if not, not\n    if(nav.id) {\n      $log.debug(\"[SubnavigationService] remove from server, too\" ,nav);\n      $sailsSocket.delete('/navigation/'+nav.id+\"?page=\"+page, {id:nav.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(cb)) {\n          return cb(null, navs);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(cb)) {\n          return cb(data);\n        }\n      });\n    }\n  };\n\n  var removeByTarget = function (navs, target, page, cb) {\n    $log.debug(\"[SubnavigationService] remove subnavigation by target \"+target);\n    var index = UtilityService.findKeyValue(navs, 'target', target);\n    if(index > -1) {\n      $log.debug(\"[SubnavigationService] subnavigation found \"+index);\n      remove(navs, index, null, page, cb);\n    } else {\n      if(angular.isFunction(cb)) {\n        cb(\"Subnavigation not found\");\n      }\n    }\n  };\n\n  var fix = function(fixed, object, index, cb) {\n    if(angular.isDefined(object.name) && angular.isString(object.name) && object.name !== \"\") {\n      fixed.push(object);\n    } else {\n      $log.warn(\"Name not set, remove Subnavigation\");\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var fixEach = function(objects, cb) {\n    var fixed = [];\n    for (var i = objects.length - 1; i >= 0; i--) {\n      fixed = fix(fixed, objects[i], i);\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var save = function(navs, page, cb) {\n    fixEach(navs, function(err, navs) {\n      $sailsSocket.put('/navigation/replaceall', {navs: navs, page: page}).success(function(data, status, headers, config) {\n        if(data !== null && typeof(data) !== \"undefined\") {\n          // WORKAROUND until socket event works\n          navs = $filter('orderBy')(data, 'position');\n          if(angular.isFunction(cb)) {\n            cb(null, navs);\n          }\n        } else {\n          var err = 'Navigation konnte nicht gespeichert werden';\n          $rootScope.pop('error', err, \"\");\n          if(angular.isFunction(cb)) {\n            cb(err, navs);\n          } \n        }\n      });\n    });\n  };\n\n  var resolve = function(page) {\n    var statename = 'layout.gallery';\n    return $sailsSocket.get('/navigation?page='+page, {page: page}).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(\"Warn: On trying to resolve \"+page+\" navs!\", \"Not found, navigation is empty!\");\n        return null;\n      }\n      data.data = $filter('orderBy')(data.data, 'position');\n      $log.debug(\"[SubnavigationService]\", data);\n      return data.data;\n    }, function error (resp){\n      $log.error(\"[SubnavigationService] Error: On trying to resolve \"+page+\" navs!\", resp);\n    });\n  };\n\n  return {\n    resizeOnImagesLoaded: resizeOnImagesLoaded,\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    create: create,\n    append: append,\n    add: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    removeByTarget: removeByTarget,\n    save: save,\n    resolve: resolve\n  };\n})\n\n.directive('jlSubnavigation', function ($compile, $window, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/subnavigation.bootstrap.jade',\n    scope: {\n      authenticated : \"=\",\n      navs: \"=\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      logger: \"=\",\n      page: \"=?\"\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Navigation entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Navigation bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Navigation hinzugefügt!\", result.title);\n        };\n      }\n\n      $scope.add = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.add($scope.navs, {page:page}, $scope.afterAdd);\n      };\n      $scope.addNav = $scope.add; // alias\n\n      $scope.moveForward = function(index, nav) {\n        SortableService.moveForward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move subnavigation forward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveForwardNav = $scope.moveForward; // alias\n\n      $scope.moveBackward = function(index, nav) {\n        SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveBackwardNav = $scope.moveBackward; // alias\n\n      $scope.edit = function(navs) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.edit(navs, $scope.afterEdit);\n      };\n      $scope.editNavs = $scope.edit; // alias\n\n      $scope.remove = function(index, nav) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.remove($scope.navs, index, nav, page, $scope.afterRemove);\n      };\n      $scope.removeNav = remove; // alias\n\n      $scope.save = function () {\n        SubnavigationService.save($scope.navs, page, $scope.afterSave);\n      };\n\n\n      // TODO move to own drag and drops sortable navigation directive \n      $scope.onDragOnComplete = function(index, nav, evt) {\n        if(nav === null) {\n          $log.debug(\"*click*\", index);\n        }\n        $log.debug(\"onDragOnComplete, nav:\", nav, \"index\", index);\n      };\n      $scope.onDragOnNavComplete = $scope.onDragOnComplete; // alias\n\n      $scope.onDropOnComplete = function(dropnavindex, dragnav, event) {\n        SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n          $scope.navs = navs;\n        });\n      };\n      $scope.onDropOnNavComplete = $scope.onDropOnComplete; // alias\n\n      $scope.onDropOnAreaComplete = function(nav, evt) {\n        var index = $scope.navs.indexOf(nav);\n      };\n\n    }\n  };\n});","angular.module('jumplink.cms.bootstrap.uploader', [\n  'angularFileUpload',\n])\n.directive('jlUploader', function () {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/uploader.bootstrap.jade',\n    scope: {\n      label : \"@\",\n      labelFiles : \"@\",\n      uploadOptions: \"=\",\n      fileOptions: \"=\",\n      onCompleteAll: \"=\",\n      onCompleteItem: \"=\",\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, $log, FileUploader) {\n      $scope.files = [];\n      if(angular.isUndefined($scope.fileOptions)) {\n        $scope.fileOptions = {};\n      }\n      $scope.uploader = new FileUploader($scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploadOptions\", $scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploader\", $scope.uploader);\n      $log.debug(\"[jlUploader] onCompleteAll\", $scope.onCompleteAll);\n      $log.debug(\"[jlUploader] onCompleteItem\", $scope.onCompleteItem);\n\n      $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n        $log.debug(\"[jlUploader.onCompleteItem] status\", status);\n        for (var i = 0; i < response.files.length; i++) {\n          $log.debug(\"[jlUploader.onCompleteItem] response.files[i]\", response.files[i]);\n        }\n        $scope.files = $scope.files.concat(response.files);\n        if(angular.isFunction($scope.onCompleteItem)) {\n          $scope.onCompleteItem(null, $scope.files); // TODO detect error\n        }\n      };\n      \n      $scope.uploader.onCompleteAll = function() {\n        $log.debug(\"[jlUploader.onCompleteAll]\");\n        if(angular.isFunction($scope.onCompleteAll)) {\n          $scope.onCompleteAll(null, $scope.files);\n        }\n      };\n\n      $scope.upload = function(fileItem) {\n        fileItem.upload();\n      };\n\n      $scope.uploader.onProgressItem = function(fileItem, progress) {\n        $log.debug('[jlUploader.onProgressItem]', fileItem, progress);\n      };\n      \n\n    }\n  };\n});","angular.module('jumplink.cms.toolbar', [\n  'FBAngular'\n])\n.directive('jlToolbar', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/toolbar.jade',\n    scope: {\n      routes: \"=\",\n      title: \"=\",\n      shorttitle: \"=\",\n      fluid: \"=\",\n      position: \"=\",\n      filter: \"=\",\n      subnavigation: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n\n    },\n    controller: function ($scope, $log, Fullscreen) {\n      $scope.fullscreenIsSupported = Fullscreen.isSupported();\n      $scope.isFullscreen = false;\n      $log.debug(\"[jumplink.cms.toolbar.jlToolbar.controller]\", $scope);\n      Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n        $scope.isFullscreen = isFullscreenEnabled === true;\n        // $scope.$apply();\n      });\n\n      $scope.toggleFullscreen = function () {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.all();\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.user', [\n    'sails.io',\n    'jumplink.cms.sails',\n  ])\n\n  .service('UserService', function ($rootScope, $sailsSocket, $log, JLSailsService) {\n    var isSubscribed = false;\n\n    var save = function(user, callback) {\n      if(!angular.isString(user.role)) {\n        user.role = \"siteadmin\";\n      }\n      \n      // update user\n      if(angular.isDefined(user.id)) {\n        $log.debug(\"update user: sailsSocket.put('/user/\"+user.id+\"..'\");\n        $sailsSocket.put('/user/'+user.id, user).success(function(data, status, headers, config) {\n          $log.debug(data, status, headers, config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      } else {\n        // create user\n        $log.debug(\"create user: sailsSocket.post('/user..\");\n        $sailsSocket.post('/user', user).success(function(data, status, headers, config) {\n          // TODO FIXME data ist not the request result ?!\n          $log.debug(\"data\", data, \"status\", status, \"headers\", headers, \"config\", config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      }\n    };\n\n    var subscribe = function () {\n      if(!isSubscribed) {\n        $sailsSocket.subscribe('user', function(msg){\n          if($rootScope.authenticated) {\n            $log.debug(msg);\n          }\n          switch(msg.verb) {\n            case 'updated':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde aktualisiert', msg.data.name);\n              }\n            break;\n            case 'created':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde erstellt', msg.data.name);\n              }\n            break;\n            case 'removedFrom':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde entfernt', \"\");\n              }\n            break;\n            case 'destroyed':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde gelöscht', \"\");\n              }\n            break;\n            case 'addedTo':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde hinzugefügt', \"\");\n              }\n            break;\n          }\n        });\n        isSubscribed = true;\n      }\n    };\n\n    var removeFromClient = function (users, user) {\n      var index = users.indexOf(user);\n      $log.debug(\"removeFromClient\", user, index);\n      if (index > -1) {\n        users.splice(index, 1);\n      }\n    };\n\n    var remove = function(users, user) {\n      $log.debug(\"$scope.remove\", user);\n      if($rootScope.authenticated) {\n        if(users.length <= 1) {\n          $log.error('Der letzte Benutzer kann nicht gelöscht werden.');\n        } else {\n          removeFromClient(users, user);\n          if(user.id) {\n            $sailsSocket.delete('/user/'+user.id, {id:user.id}).success(function(data, status, headers, config) {\n              $log.debug(\"user delete request\", data, status, headers, config);\n            });\n          }\n        }\n      }\n    };\n\n    /**\n     * find users for any host from database and isert priority from database (or from local.json if no priority is set).\n     * Only for superadmins!\n     */\n    var findByHost = function(host, callback) {\n      // $log.debug(\"[ThemeService.findByHost]\", host);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/user/findbyhost', {host: host}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, user, callback) {\n      $log.debug(\"[UserService.updateOrCreateByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/user/updateOrCreateByHost', {host: host, user: user}, options, callback);\n    };\n\n    return {\n      save: save,\n      subscribe: subscribe,\n      remove: remove,\n      findByHost: findByHost,\n      updateOrCreateByHost: updateOrCreateByHost\n    };\n  })\n;","angular.module('jumplink.cms.utilities', [\n  ])\n  .service('UtilityService', function ($log) {\n    var invertOrder = function (array) {\n      var result = [];\n      for (var i = array.length - 1; i >= 0; i--) {\n        result.push(array[i]);\n      }\n      return result;\n    };\n\n    /**\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /**\n     * @see: http://stackoverflow.com/questions/3068534/getting-javascript-object-key-list\n     */\n    var getKeys = function (obj) {\n      var keys = [];\n      if(!angular.isObject(obj)) {\n        console.error(\"[UtilityService.getKeys] is not an Object\", obj);\n        return keys;\n      }\n      for(var k in obj) {\n        keys.push(k);\n      }\n      return keys;\n    };\n\n    /**\n     * Capitalize the first character of a string, but not change the case of any of the other letters.\n     *\n     * @see http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript\n     */\n    var capitalizeFirstLetter = function (string) {\n      return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n    };\n\n    var lowercaseFirstLetter = function (string) {\n      return string.charAt(0).toLowerCase() + string.slice(1);\n    };\n\n    return {\n      invertOrder: invertOrder,\n      findKeyValue: findKeyValue,\n      getKeys: getKeys,\n      capitalizeFirstLetter: capitalizeFirstLetter,\n      lowercaseFirstLetter: lowercaseFirstLetter,\n    };\n  });","angular.module('jumplink.cms.bootstrap.validation', [\n  'jumplink.cms.validation',\n])\n.provider('jlValidationBootstrap', function jlValidationBootstrapProvider(jlValidationProvider, $validationProvider) {\n  this.setup = function () {\n    $validationProvider.setErrorHTML(function (msg) {\n      return \"<span ng-show='form.name.$error.required' class='form-control-feedback'><i class='fa fa-exclamation-triangle'></i></span><label class=\\\"control-label has-error absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    $validationProvider.setSuccessHTML(function (msg) {\n      return \"<span class='form-control-feedback'><i class='fa fa-check'></i></span><label class=\\\"control-label has-success absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    angular.extend($validationProvider, {\n      validCallback: function (element){\n        $(element).parents('.form-group:first').removeClass('has-error').addClass('has-success');\n      },\n      invalidCallback: function (element) {\n        $(element).parents('.form-group:first').removeClass('has-success').addClass('has-error');\n      }\n    });\n  };\n  this.getLocale = jlValidationProvider.getLocale;\n  this.changeLocale = jlValidationProvider.changeLocale;\n  this.$get = function jlValidationBootstrapFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidationBootstrap();\n  };\n});","angular.module('jumplink.cms.validation', [\n  'validation',                               // https://github.com/huei90/angular-validation\n  'validation.rule',                          // https://github.com/huei90/angular-validation\n])\n.provider('jlValidation', function jlValidationProvider($validationProvider) {\n  this.getLocale = function () {\n    var defaultMsg = {\n      \"minlength\": $validationProvider.getDefaultMsg('minlength'),\n      \"maxlength\": $validationProvider.getDefaultMsg('maxlength'),\n      \"required\": $validationProvider.getDefaultMsg('required'),\n      \"email\": $validationProvider.getDefaultMsg('email'),\n      \"number\": $validationProvider.getDefaultMsg('number'),\n      \"url\": $validationProvider.getDefaultMsg('url'),\n    };\n    return defaultMsg;\n  };\n  this.changeLocale = function (lang) {\n    var defaultMsg = {};\n    switch(lang) {\n      case 'de':\n        defaultMsg = {\n          'minlength': {\n            error: \"Eingabe muss länger sein!\",\n            success: \"Eingabe lang genug\"\n          },\n          'maxlength': {\n            error: \"Eingabe muss kürzer sein!\",\n            success: \"Eingabe kurz genug\"\n          },\n          'required': {\n            error: \"Eine Eingabe ist erforderlich!\",\n            success: \"Okay\"\n          },\n          'email': {\n            error: \"Eingabe muss einer E-Mail entsprechen!\",\n            success: \"Eingabe ist eine E-Mail\"\n          },\n          'number': {\n            error: \"Eingabe darf nur Zahlen enthalten!\",\n            success: \"Eingabe enthält nur Zahlen\"\n          },\n          'url': {\n            error: \"Eingabe muss einer URL entsprechen!\",\n            success: \"Eingabe entspricht einer URL\"\n          },\n        };\n      break;\n      case 'en':\n      break;\n      default:\n      break;\n    }\n    switch(lang) {\n      case 'de':\n        $validationProvider.setDefaultMsg(defaultMsg);\n      break;\n      case 'en':\n        // do nothing\n      break;\n      default:\n        // do nothing\n      break;\n    }\n  };\n  this.$get = function jlValidationFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidation();\n  };\n});","jumplink.cms = angular.module('jumplink.cms', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'ngAnimate',               // ngAnimate: https://docs.angularjs.org/api/ngAnimate\n  'ngSanitize',              // ngSanitize: https://docs.angularjs.org/api/ngSanitize\n  'sails.io',                // angularSails: https://github.com/balderdashy/angularSails\n  //, 'webodf',                  // custom module\n  'FBAngular',               // angular-fullscreen: https://github.com/fabiobiondi/angular-fullscreen\n  'mgcrea.ngStrap',          // AngularJS 1.2+ native directives for Bootstrap 3: http://mgcrea.github.io/angular-strap/\n  'angularMoment',           // Angular.JS directive and filters for Moment.JS: https://github.com/urish/angular-moment\n  // , 'wu.masonry',              // A directive to use masonry with AngularJS: http://passy.github.io/angular-masonry/\n  'angular-carousel',        // An AngularJS carousel implementation optimised for mobile devices: https://github.com/revolunet/angular-carousel\n  // , 'textAngular',             // A radically powerful Text-Editor/Wysiwyg editor for Angular.js: https://github.com/fraywing/textAngular\n  'angular-medium-editor',   // AngularJS directive for Medium.com editor clone: https://github.com/thijsw/angular-medium-editor\n  'ui.ace',                  // This directive allows you to add ACE editor elements: https://github.com/angular-ui/ui-ace\n // , 'leaflet-directive',       // AngularJS directive to embed an interact with maps managed by Leaflet library: https://github.com/tombatossals/angular-leaflet-directive\n  'toaster',                 // AngularJS Toaster is a customized version of \"toastr\" non-blocking notification javascript library: https://github.com/jirikavi/AngularJS-Toaster\n  //, 'angularFileUpload',       // Angular File Upload is a module for the AngularJS framework: https://github.com/nervgh/angular-file-upload\n  'angular-filters',         // Useful filters for AngularJS: https://github.com/niemyjski/angular-filters\n  'ngDraggable',             // Drag and drop module for Angular JS: https://github.com/fatlinesofcode/ngDraggable\n  'toggle-switch',           // AngularJS Toggle Switch: https://github.com/JumpLink/angular-toggle-switch\n  'ngAsync',\n  'ngFocus',\n  'jumplink.cms.history',\n  'jumplink.cms.content',\n  'jumplink.cms.content.medium',\n  'jumplink.cms.bootstrap.content',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'jumplink.cms.subnavigation',\n  'jumplink.cms.info',\n  'jumplink.cms.config',\n  //, 'jumplink.cms.event',\n  'jumplink.cms.user',\n  'jumplink.cms.theme',\n  //, 'jumplink.cms.gallery',\n  'jumplink.cms.admin',\n  'jumplink.cms.session',\n  'jumplink.cms.multisite',\n  'jumplink.cms.routes',\n  'jumplink.cms.bootstrap.routes',\n  'jumplink.cms.sidebar',\n  'jumplink.cms.toolbar',\n  'jumplink.cms.signin',\n  'ngDownload',\n]);","jumplink.cms.run(function(amMoment) {\n  amMoment.changeLocale('en');\n});\n","jumplink.cms.config( function($logProvider) {\n  // see variables.jade environment variable\n  // $logProvider.debugEnabled(environment === 'development');\n  $logProvider.debugEnabled(true);\n});","jumplink.cms.config( function(jlRoutesProvider) {\n\n  var routeOptions = {};\n\n  // use the HTML5 History API\n  jlRoutesProvider.html5Mode(true);\n\n  jlRoutesProvider.otherwise('/error/Request not found!');\n\n  // LAYOUT\n  jlRoutesProvider.state('layout', {\n    abstract: true,\n    templateUrl: '/views/modern/layout.jade',\n    controller: 'LayoutController',\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n      sites: function(MultisiteService) {\n        return MultisiteService.resolveNames({});\n      },\n      hosts: function(MultisiteService) {\n        return MultisiteService.resolveHosts({});\n      }\n    },\n  });\n\n  routeOptions.layoutHome = {\n    resolve: {},\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/home/home.jade',\n        controller: 'HomeController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  };\n\n  routeOptions.layoutThemes = {\n    resolve: {},\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/themes/themes.jade',\n        controller: 'ThemesController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  };\n\n  routeOptions.layoutRoutes = {\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/routes/routes.jade',\n        controller: 'RoutesController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  };\n\n  routeOptions.layoutContent = {\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/content/content.jade',\n        controller: 'ContentController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    },\n  };\n\n  routeOptions.layoutUsers = {\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/user/users.jade',\n        controller: 'UsersController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  };\n\n  jlRoutesProvider.state('layout.user', {\n    url: '/user/:index',\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n      user: function($sailsSocket, $stateParams, $log) {\n        return $sailsSocket.get('/user'+'/'+$stateParams.index).then (function (data) {\n          delete data.data.password;\n          return data.data;\n        }, function error (resp){\n          $log.error(resp);\n        });\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/user/user.jade',\n        controller: 'UserController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  });\n\n  jlRoutesProvider.state('layout.new-user', {\n    url: '/new/user',\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n      user: function() {\n        return {\n\n        };\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/user/user.jade',\n        controller: 'UserController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  });\n\n  routeOptions.layoutStatus = {\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.needToBeAuthenticated();\n      },\n      status: function(CmsService, $log) {\n        $log.debug(\"start get cms info\");\n        return CmsService.infoAdmin();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/status/status.jade',\n        controller: 'StatusController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    },\n  };\n\n  // ERROR LAYOUT\n  jlRoutesProvider.state('error', {\n    abstract: true,\n    templateUrl: '/views/modern/layout.jade',\n    // controller: 'ErrorController',\n  });\n\n  jlRoutesProvider.state('error.signin', {\n    url: '/error/:error',\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/error/error.jade',\n        controller: 'ErrorController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar routes=\"routes\", title=\"title\", shorttitle=\"shorttitle\", position=\"position\", fluid=\"fluid\", name=\"name\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      },\n    }\n  });\n\n  jlRoutesProvider.setRoutes(routes, routeOptions);\n});\n\njumplink.cms.run(function ($rootScope, $state, $window, $log) {\n  $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {\n    $log.error(\"[config/routes.js] Error\", error);\n    $state.go('error.signin', {error: error});\n  });\n});\n","jumplink.cms.run(function(amMoment) {\n  amMoment.changeLocale('de');\n});\n","jumplink.cms.controller('AppController', function($rootScope, $scope, $state, $window, $timeout, Fullscreen, toaster, $sailsSocket, $location, HistoryService, $log) {\n\n  // fix scroll to top on route change\n  $scope.$on(\"$stateChangeSuccess\", function () {\n    HistoryService.autoScroll();\n  });\n\n  //AngularJS Toaster - AngularJS Toaster is a customized version of \"toastr\" non-blocking notification javascript library: https://github.com/jirikavi/AngularJS-Toaster\n  $rootScope.pop = function(type, title, body, timeout, bodyOutputType, clickHandler) {\n    toaster.pop(type, title, body, timeout, bodyOutputType, clickHandler);\n  };\n\n  var generalSubscribes = function () {\n\n    $sailsSocket.post('/session/subscribe', {}).success(function(data, status, headers, config){\n\n      // react to subscripe from server: http://sailsjs.org/#/documentation/reference/websockets/sails.io.js/io.socket.on.html\n      $sailsSocket.subscribe('connect', function(msg){\n        $log.debug('socket.io is connected');\n      });\n\n      $sailsSocket.subscribe('disconnect', function(msg){\n        $rootScope.pop('error', 'Verbindung zum Server verloren', \"\");\n        $rootScope.authenticated = false;\n      });\n\n      $sailsSocket.subscribe('reconnect', function(msg){\n        $rootScope.pop('info', 'Sie sind wieder mit dem Server verbunden', \"\");\n      });\n    });\n  };\n\n  var adminSubscribes = function() {\n    // subscripe on server\n    $sailsSocket.post('/session/subscribe', {}).success(function(data, status, headers, config){\n\n      // called on any sended email from server\n      $sailsSocket.subscribe('email', function(email){\n\n        var body = ''+\n          '<dl>'+\n            '<dt>Absender</dt>'+\n            '<dd><a href=\"mailto:'+email.from+'\">'+email.from+'</a></dd>'+\n            '<dt>Betreff</dt>'+\n            '<dd>'+email.subject+'</dd>';\n            if(email.attachments) {\n              body += ''+\n              '<dt>Anhänge</dt>'+\n              '<dd>'+email.attachments.length+'</dd>';\n            }\n            body += ''+\n          '</dl>';\n\n        $rootScope.pop('info', 'Eine E-Mail wurde versendet.', body, null, 'trustedHtml');\n      });\n\n      // admin room\n      $sailsSocket.subscribe('admins', function(msg){\n        $log.debug(msg);\n      });\n\n    });\n  };\n\n  // http://stackoverflow.com/questions/18608161/angularjs-variable-set-in-ng-init-undefined-in-scope\n  $rootScope.$watch('authenticated', function () {\n    // $log.debug(\"authenticated: \"+$rootScope.authenticated);\n    if($rootScope.authenticated) {\n      $rootScope.mainStyle = {'padding-bottom':'50px'};\n      $rootScope.toasterPositionClass = 'toast-bottom-right-with-toolbar';\n      adminSubscribes();\n    } else {\n      $rootScope.mainStyle = {'padding-bottom':'0px'};\n      $rootScope.toasterPositionClass = 'toast-bottom-right';\n    }\n  });\n  generalSubscribes();\n\n  $rootScope.fullscreenIsSupported = Fullscreen.isSupported();\n  $rootScope.isFullscreen = false;\n  Fullscreen.$on('FBFullscreen.change', function (evt, isFullscreenEnabled) {\n    $rootScope.isFullscreen = isFullscreenEnabled === true;\n    $rootScope.$apply();\n  });\n\n  $rootScope.toggleFullscreen = function () {\n    if (Fullscreen.isEnabled()) {\n      Fullscreen.cancel();\n    } else {\n      Fullscreen.all();\n    }\n  };\n\n  // TODO loading animation on $stateChangeStart\n    $rootScope.$on('$stateChangeStart',\n  function(event, toState, toParams, fromState, fromParams){\n    // $rootScope.loadclass = 'loading'; // WORKAROUND comment because event is not always fired, see FIXME\n  });\n\n  // on new url\n  $rootScope.$on('$stateChangeSuccess',\n  function(event, toState, toParams, fromState, fromParams){\n    $rootScope.loadclass = 'finish'; // FIXME this event is not always fired\n    switch(toState.name) {\n      case \"layout.home\":\n        $rootScope.bodyclass = 'home';\n      break;\n      case \"layout.gallery\":\n        $rootScope.bodyclass = 'gallery';\n      break;\n      case \"layout.gallery-slider\":\n        $rootScope.bodyclass = 'gallery-slider';\n      break;\n      default:\n        $rootScope.bodyclass = toState.name;\n      break;\n    }\n  });\n\n  $rootScope.getWindowDimensions = function () {\n    return { 'height': angular.element($window).height(), 'width': angular.element($window).width() };\n  };\n\n  angular.element($window).bind('resize', function () {\n    // $timeout(function(){\n    //   $rootScope.$apply();\n    // });\n    // $rootScope.$apply();\n  });\n\n  // http://stackoverflow.com/questions/641857/javascript-window-resize-event\n  if(angular.element($window).onresize) { // if jQuery is used\n    angular.element($window).onresize = function(event) {\n      $timeout(function(){\n        $rootScope.$apply();\n      });\n    };\n  }\n\n  // http://stackoverflow.com/questions/22991481/window-orientationchange-event-in-angular\n  angular.element($window).bind('orientationchange', function () {\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  });\n\n  angular.element($window).bind('deviceorientation', function () {\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  });\n\n  $rootScope.$watch($rootScope.getWindowDimensions, function (newValue, oldValue) {\n    $rootScope.windowHeight = newValue.height;\n    $rootScope.windowWidth = newValue.width;\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  }, true);\n\n  $rootScope.logout = function() {\n    $sailsSocket.post(\"/session/destroy\", {}).success(function(data, status, headers, config) {\n      $rootScope.authenticated = false;\n      $rootScope.pop('success', 'Erfolgreich abgemeldet', \"\");\n    });\n  };\n\n  $scope.goToState = $state.go;\n\n});","jumplink.cms.controller('ContentController', function($rootScope, $scope, $log, $download, ContentService, ContentBootstrapService, UtilityService, HistoryService, SortableService) {\n  if(angular.isUndefined($scope.contents)) {\n    $scope.contents = [];\n  }\n  $scope.showMaincontents = false;\n  $scope.goToHashPosition = HistoryService.goToHashPosition;\n\n  // ================ START: import export stuff ================\n  var onImportFinsih = function (err, contents) {\n    if(err) {\n      $log.error(\"[ContentController.onImportFinsih]\", err);\n      return err;\n    }\n    $log.debug(\"[ContentController.onImportFinsih]\", contents);\n    $scope.contents = contents;\n  };\n\n  ContentBootstrapService.setupImportModal($scope, onImportFinsih);\n  ContentBootstrapService.setHost($rootScope.selectedHost);\n\n  /**\n   * Export contents and download them\n   */\n  $scope.download = function() {\n    ContentService.exportByHost($rootScope.selectedHost, true, function(err, results) {\n\n    });\n  };\n\n  /**\n   * Upload contents and import them\n   */\n  $scope.upload = function() {\n    ContentBootstrapService.showImportModal(function(err, result) {\n      $log.debug(\"ContentController.upload\", err, result);\n    });\n  };\n\n  $rootScope.$watch('selectedHost', function(newValue, oldValue) {\n    // $log.debug(\"[ContentController] selectedHost changed from\",oldValue,\"to\",newValue);\n    if(angular.isDefined(newValue)) {\n      ContentBootstrapService.setHost(newValue);\n      ContentService.findByHost({host:newValue}, function(err, contents) {\n        if(err) {\n          $scope.contents = [];\n        }\n        else {\n          $scope.contents = SortableService.sort(contents);\n        }\n        $log.debug(\"[ContentController] new contents\", contents);\n      });\n    }\n  });\n\n  // ================ END: import export stuff ================\n\n  $scope.save = function() {\n    ContentService.saveEachByHost($rootScope.selectedHost, $scope.contents, function(err, results) {\n      if(err) {\n        $log.error(\"[contentController.save] Error!\", err);\n        return err;\n      }\n      $scope.contents = results;\n    });\n  };\n\n  $scope.destroy = function(index, content) {\n    $log.debug('[contentController.destroy] content', content);\n    ContentService.destroy($scope.contents, index, content, function(result) {\n      $log.debug('[contentController.destroy] result', result);\n    });\n  };\n\n  $scope.add = function() {\n    var data = {main: true};\n    ContentService.append($scope.contents, data, function(err, contents) {\n      $scope.contents = contents;\n      if(err) {\n        $log.error(\"Error: On add contents!\", err);\n        return err;\n      }\n      $log.debug(\"[ContentController.add] Add contents done!\", contents);\n    });\n  };\n\n \n  $scope.edit = function($index, content) {\n    $log.debug(\"[ContentController.edit] TODO!\", $index, content);\n  };\n\n\n});\n","jumplink.cms.controller('ErrorController', function($rootScope, $scope, $log, $stateParams, SessionService, SigninService, $state) {\n  $scope.error = $stateParams.error;\n\n  $scope.signin = function () {\n    $log.debug($scope.user);\n    // $scope.user.role = 'superadmin';\n    SigninService.signin($scope.user, false, function (err, result) {\n      if(err) {\n        $scope.error = err;\n        return err;\n      }\n      $state.go('layout.home');\n      $log.debug(result);\n    });\n  };\n\n  $scope.signin = function () {\n    $log.debug(\"[SigninController.signin]\", $scope.user);\n    SigninService.signin($scope.user, false, function (err, result) {\n      if(err) {\n        $scope.error = err;\n        return $scope.error ;\n      }\n      if(result.authenticated) {\n        $rootScope.authenticated = result.authenticated;\n        $rootScope.user = result.user;\n        $rootScope.site = result.site;\n        SessionService.isAuthenticated(function (err, isAuthenticated) {\n          $rootScope.authenticated = isAuthenticated;\n          SessionService.superadmin(function (err, isSuperadmin) {\n            $rootScope.superadmin = isSuperadmin;\n            $state.go('layout.home');\n          });\n        });        \n      }\n      $log.debug(\"[SigninController.signin]\", result);\n    });\n  };\n  \n});","jumplink.cms.controller('FooterController', function($scope) {\n\n});","jumplink.cms.controller('HomeController', function($scope, $log, authenticated) {\n\n  $log.debug('authenticated', authenticated);\n  \n});","jumplink.cms.controller('LayoutController', function($rootScope, sites, hosts) {\n\n  $rootScope.sites = sites;\n  $rootScope.selectedSite = sites[0];\n\n  $rootScope.hosts = hosts;\n  $rootScope.selectedHost = hosts[0];\n});","jumplink.cms.controller('RoutesController', function($rootScope, $scope, $log, $download, RoutesService, RoutesBootstrapService, UtilityService, HistoryService, SortableService) {\n  if(angular.isUndefined($scope.routes)) {\n    $scope.routes = [];\n  }\n  $scope.showMainRoutes = false;\n  $scope.goToHashPosition = HistoryService.goToHashPosition;\n\n  // ================ START: import export stuff ================\n  var onImportFinsih = function (err, routes) {\n    if(err) {\n      $log.error(\"[RoutesController.onImportFinsih]\", err);\n      return err;\n    }\n    $log.debug(\"[RoutesController.onImportFinsih]\", routes);\n    $scope.routes = routes;\n  };\n\n  RoutesBootstrapService.setupImportModal($scope, onImportFinsih);\n  RoutesBootstrapService.setHost($rootScope.selectedHost);\n\n  /**\n   * Export routes and download them\n   */\n  $scope.download = function() {\n    RoutesService.exportByHost($rootScope.selectedHost, true, function(err, results) {\n\n    });\n  };\n\n  /**\n   * Upload routes and import them\n   */\n  $scope.upload = function() {\n    RoutesBootstrapService.showImportModal(function(err, result) {\n      $log.debug(\"RoutesController.upload\", err, result);\n    });\n  };\n\n  $rootScope.$watch('selectedHost', function(newValue, oldValue) {\n    // $log.debug(\"[RoutesController] selectedHost changed from\",oldValue,\"to\",newValue);\n    if(angular.isDefined(newValue)) {\n      RoutesBootstrapService.setHost(newValue);\n      RoutesService.findByHost({host:newValue}, function(err, routes) {\n        if(err) {\n          $scope.routes = [];\n        }\n        else {\n          $scope.routes = SortableService.sort(routes);\n        }\n        // $log.debug(\"[RoutesController] new routes\",routes);\n      });\n    }\n  });\n\n  // ================ END: import export stuff ================\n\n  var appendToStatename = function (statename, toAppend) {\n    $log.debug(\"[RoutesController.appendToStatename]\", statename, toAppend);\n    if(angular.isString(toAppend) && toAppend.length > 0) {\n      if(angular.isString(statename) && statename.length > 0) {\n        statename += \".\"+toAppend.toLowerCase();\n      } else {\n        statename = toAppend.toLowerCase();\n      }\n    }\n    return statename;\n  };\n\n  var generateObjectnameAndStatename = function (route) {\n    route.state.name = \"\";\n    route.state.name = appendToStatename(route.state.name, route.state.parent);\n    route.state.name = appendToStatename(route.state.name, route.key);\n    route.objectName = RoutesService.generateObjectnameFromStatename(route.state.name);\n    if(!angular.isString(route.objectName) || route.objectName.length <= 0) {\n      route.objectName = RoutesService.generateObjectnameFromUrl(route.url);\n    }\n    return route;\n  };\n\n  $scope.$watch('routes', function (newValue, oldValue) {\n    $log.log(\"[RoutesController.watch.routes]\", newValue);\n    for(var i = 0; i < $scope.routes.length; i++) {\n      $scope.routes[i] = generateObjectnameAndStatename($scope.routes[i]);\n    }\n  }, true);\n\n  $scope.save = function() {\n    RoutesService.saveEachByHost($rootScope.selectedHost, $scope.routes, function(err, results) {\n      if(err) {\n        $log.error(\"[RouteController.save] Error!\", err);\n        return err;\n      }\n      $scope.routes = results;\n    });\n  };\n\n  $scope.destroy = function(index, route) {\n    $log.debug('[RouteController.destroy] route', route);\n    RoutesService.destroy($scope.routes, index, route, function(result) {\n      $log.debug('[RouteController.destroy] result', result);\n    });\n  };\n\n  $scope.add = function() {\n    var data = {main: true};\n    RoutesService.append($scope.routes, data, function(err, routes) {\n      $scope.routes = routes;\n      if(err) {\n        $log.error(\"Error: On add routes!\", err);\n        return err;\n      }\n      $log.debug(\"[RoutesController.add] Add routes done!\", routes);\n    });\n  };\n\n  $scope.addAlternativeUrl = function($index, route) {\n    $log.debug(\"[RoutesController.addAlternativeUrl]\", $index, route);\n    if(angular.isUndefined(route.alternativeUrls) || !angular.isArray(route.alternativeUrls)) {\n      route.alternativeUrls = [\"\"];\n    }\n    route.alternativeUrls.push(\"\");\n  };\n\n  $scope.removeAlternativeUrl = function($index, route) {\n    $log.debug(\"[RoutesController.removeAlternativeUrl]\", $index, route);\n    if(route.alternativeUrls.length >= 1) {\n      route.alternativeUrls.pop();\n    }\n  };\n\n  $scope.edit = function($index, route) {\n    $log.debug(\"[RoutesController.edit] TODO!\", $index, route);\n  };\n\n  $scope.moveForward = function(index, route) {\n    RoutesService.moveForward(index, $scope.routes, function(err, routes) {\n      if(err) {\n        $log.error(\"Error: On move route forward!\", err);\n        return err;\n      }\n      $scope.routes = routes;\n    });\n  };\n\n  $scope.moveBackward = function(index, route) {\n    RoutesService.moveBackward(index, $scope.routes, function(err, routes) {\n      if(err) {\n        $log.error(\"Error: On move route backward!\", err);\n        return err;\n      }\n      $scope.routes = routes;\n    });\n  };\n\n});\n","jumplink.cms.controller('StatusController', function($rootScope, $scope, status, $location, $anchorScroll, $state, $log, $interval, CmsService, moment) {\n  var page = $state.current.name;\n  $scope.status = status;\n\n  $log.debug(\"[StatusController]\", $scope.status);\n\n  $scope.goTo = function (hash) {\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  $scope.restart = function () {\n    $log.debug(\"[StatusController.restart]\");\n    CmsService.restart(function (err, res) {\n      $log.debug(err, res);\n    });\n  };\n\n  var calcUptime = function () {\n    $scope.uptime = moment($scope.status.pm2[0].pm2_env.pm_uptime).fromNow(true);\n  };\n  calcUptime();\n  $interval(calcUptime, 1000);\n\n});","jumplink.cms.controller('ThemesController', function($rootScope, $scope, $log, ThemeService) {\n  $scope.themeSettings = {};\n\n  $rootScope.$watch('selectedHost', function(newValue, oldValue) {\n    $log.debug(\"[ThemesController] selectedHost changed from\",oldValue,\"to\",newValue);\n    if(angular.isDefined(newValue)) {\n      ThemeService.findByHost(newValue, function(err, themes) {\n        $scope.themeSettings = themes;\n      });\n    }\n  });\n  \n  $scope.save = function() {\n    $log.debug('themeSettings', $scope.themeSettings);\n    ThemeService.updateOrCreateEachByHost($rootScope.selectedHost, $scope.themeSettings.available, function(data) {\n      // $scope.themeSettings = data;\n      $log.debug(data);\n    });\n  };\n  \n});","jumplink.cms.controller('ToolbarController', function($scope, $log, routes) {\n\n  $scope.routes = routes;\n  $scope.title = \"JumpLink CMS Administration\";\n  $scope.shorttitle = \"Admin\";\n  $scope.position = \"fixed-top\";\n  $scope.fluid = true;\n});","jumplink.cms.controller('UserController', function($scope, $rootScope, user, $state, $log, UserService) {\n  $scope.user = user;\n\n  $scope.save = function (user) {\n    if(angular.isUndefined(user)) {\n      user = $scope.user;\n    }\n    UserService.updateOrCreateByHost($rootScope.selectedHost, user, function (err, user) {\n      $state.go('layout.users');\n    });\n  };\n\n  UserService.subscribe();\n});","jumplink.cms.controller('UsersController', function($scope, $rootScope, $sailsSocket, $log, UserService) {\n  $scope.users = {};\n\n  $rootScope.$watch('selectedHost', function(newValue, oldValue) {\n    $log.debug(\"[ThemesController] selectedHost changed from\",oldValue,\"to\",newValue);\n    if(angular.isDefined(newValue)) {\n      UserService.findByHost(newValue, function(err, users) {\n        $scope.users = users;\n      });\n    }\n  });\n\n  $scope.remove = function(user) {\n    UserService.remove($scope.users, user);\n  };\n\n  UserService.subscribe();\n\n});"],"sourceRoot":"/source/"}